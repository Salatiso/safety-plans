<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ensure construction health and safety compliance with SafetyHelp OHS Tools.">
    <meta name="keywords" content="OHS tools, construction safety, occupational health and safety, safety plans, South Africa OHS, SafetyHelp">
    <meta name="author" content="SafetyHelp Team">
    <title data-i18n="page_title.construction">SafetyHelp - Construction Health and Safety</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/i18next@23.15.2/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector@8.0.0/dist/i18nextBrowserLanguageDetector.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Global Styles */
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #E8F0FE;
            color: #333;
            margin: 0;
            padding-top: 100px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header h1, .sidebar h2, .sidebar h3, .intro h2, footer h3, #wizard-content h3, #wizard-sidebar h4, .legal-card h3, .cart-container h3, .resources h3 {
            font-family: 'Montserrat', sans-serif;
        }
        /* Header */
        header {
            background-color: #007BFF;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            width: 100%;
        }
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .search-language-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .search-bar button {
            background-color: #FD7E14;
            color: white;
        }
        .search-bar button:hover {
            background-color: #e06b00;
        }
        .language-selector {
            margin-bottom: 5px;
        }
        .language-selector select {
            padding: 4px;
            border-radius: 4px;
            font-size: 14px;
        }
        .nav-links {
            text-align: center;
            flex: 1;
        }
        .nav-links a {
            color: white;
            margin: 0 15px;
            font-family: 'Montserrat', sans-serif;
            text-decoration: none;
        }
        .nav-links a:hover {
            color: #FD7E14;
        }
        .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        .logo-container img {
            height: 50px;
        }
        .tagline {
            font-size: 14px;
            margin-top: 5px;
        }
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 100px;
            left: 0;
            bottom: 0;
            width: 250px;
            background-color: #F4F4F4;
            overflow-y: auto;
            z-index: 40;
            padding: 15px;
        }
        .sidebar h2 {
            color: #007BFF;
            font-size: 24px;
            margin-bottom: 15px;
            text-align: right;
        }
        .sidebar a {
            color: white;
            background-color: #007BFF;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 5px;
            display: block;
            text-decoration: none;
            font-size: 14px;
            transition: font-weight 0.3s;
        }
        .sidebar a:hover {
            font-weight: bold;
            background-color: #0056b3;
        }
        .sidebar a.active {
            background-color: #28A745;
        }
        .step-info {
            background-color: #E8F0FE;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .step-info h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            color: #007BFF;
            margin-bottom: 10px;
        }
        .step-info p {
            font-size: 14px;
        }
        .fun-fact {
            color: #28A745;
        }
        /* Main Content */
        .main-content {
            margin-left: 250px;
            flex-grow: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }
        .intro {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 24px;
        }
        .intro h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }
        .intro h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 10px;
        }
        .intro p {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }
        .intro a {
            background-color: #FD7E14;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
        }
        .intro a:hover {
            background-color: #e06b00;
        }
        /* Footer */
        footer {
            background-color: #007BFF;
            color: white;
            padding: 15px;
            text-align: center;
            width: 100%;
            margin-top: auto;
        }
        footer p {
            font-size: 14px;
            margin: 5px 0;
        }
        footer a {
            color: #FD7E14;
            text-decoration: none;
        }
        footer a:hover {
            color: #e06b00;
        }
        .newsletter h3 {
            font-size: 14px;
            margin-bottom: 8px;
        }
        .newsletter input {
            padding: 8px;
            border: none;
            border-radius: 2px;
            margin-right: 10px;
            font-size: 14px;
            width: 150px;
        }
        .newsletter button {
            padding: 8px 16px;
            background-color: #FD7E14;
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
        }
        .newsletter button:hover {
            background-color: #e06b00;
        }
        /* Chatbot */
        .chatbot-container {
            position: fixed;
            bottom: 1.25rem;
            right: 1.25rem;
            z-index: 1000;
        }
        #chat-window {
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .chat-hidden {
            display: none;
        }
        #chat-output {
            flex-grow: 1;
        }
        #chat-input-container {
            display: flex;
            border-top-width: 1px;
        }
        #chat-input {
            flex-grow: 1;
            border: none;
            padding: 0.5rem;
        }
        #chat-send {
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
        }
        #chat-send:hover {
            background-color: #0056b3;
        }
        .chat-toggle-btn {
            background-color: #FD7E14;
        }
        .chat-toggle-btn:hover {
            background-color: #e06b00;
        }
        /* Wizard Sidebar specific styles */
        #wizard-sidebar {
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }
        /* Style for active sidebar link */
        .sidebar a.active {
            background-color: #28A745;
        }
        /* Ensure details/summary work well */
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details > summary::before {
            content: '► ';
            font-size: 0.8em;
            margin-right: 4px;
        }
        details[open] > summary::before {
            content: '▼ ';
        }
        /* Style for form elements */
        .form-group input, .form-group select, .form-group textarea {
            margin-top: 4px;
            display: block;
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            font-size: 14px;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }
        .form-group .error {
            color: #ef4444;
            font-size: 12px;
            margin-top: 4px;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding-top: 0;
                flex-direction: column;
            }
            header {
                position: relative;
            }
            .header-container {
                flex-direction: column;
                align-items: center;
            }
            .header-left {
                align-items: center;
                margin-bottom: 10px;
            }
            .nav-links {
                margin: 10px 0;
            }
            .nav-links a {
                margin: 5px 10px;
            }
            .header-right {
                align-items: center;
            }
            .sidebar {
                position: relative;
                top: 0;
                width: 100%;
                height: auto;
                bottom: auto;
                z-index: 1;
            }
            .sidebar h2 {
                text-align: center;
            }
            .main-content {
                margin-left: 0;
                flex-direction: column;
            }
            .intro, #wizard-container, #cart-container, .resources {
                margin: 1rem 0;
            }
            #wizard-container {
                flex-direction: column;
            }
            #wizard-sidebar {
                width: 100%;
                margin-top: 1rem;
                max-height: none;
            }
            .legal-obligations {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container mx-auto header-container">
            <div class="header-left">
                <div class="logo-container">
                    <img src="assets/images/logo.png" alt="SafetyHelp Logo">
                    <p class="tagline" data-i18n="header.tagline">Safety Personalized, Compliance Simplified—Anytime, Anywhere</p>
                </div>
            </div>
            <div class="nav-links">
                <a href="/safety-plans/index.html" data-i18n="header.nav.home">Home</a>
                <a href="/safety-plans/resources.html" data-i18n="header.nav.resources">Resources</a>
                <a href="/safety-plans/services.html" data-i18n="header.nav.services">Services</a>
                <a href="/safety-plans/community.html" data-i18n="header.nav.community">Community</a>
                <a href="/safety-plans/about.html" data-i18n="header.nav.about">About</a>
                <a href="/safety-plans/contact.html" data-i18n="header.nav.contact">Contact</a>
                <a href="#" id="login-link" data-i18n="header.nav.login">Login</a>
            </div>
            <div class="header-right">
                <div class="search-language-container">
                    <div class="language-selector">
                        <select id="language-select" aria-label="Select language">
                            <option value="en" data-i18n="language_selector.en">English</option>
                            <option value="af" data-i18n="language_selector.af">Afrikaans</option>
                            <option value="zu" data-i18n="language_selector.zu">isiZulu</option>
                            <option value="xh" data-i18n="language_selector.xh">isiXhosa</option>
                            <option value="st" data-i18n="language_selector.st">Sesotho</option>
                            <option value="tn" data-i18n="language_selector.tn">Setswana</option>
                            <option value="nso" data-i18n="language_selector.nso">Sepedi</option>
                            <option value="ts" data-i18n="language_selector.ts">Xitsonga</option>
                            <option value="ss" data-i18n="language_selector.ss">siSwati</option>
                            <option value="ve" data-i18n="language_selector.ve">Tshivenda</option>
                            <option value="nr" data-i18n="language_selector.nr">isiNdebele</option>
                            <option value="es" data-i18n="language_selector.es">Español</option>
                            <option value="fr" data-i18n="language_selector.fr">French</option>
                            <option value="sn" data-i18n="language_selector.sn">Shona</option>
                            <option value="sw" data-i18n="language_selector.sw">Swahili</option>
                            <option value="zh" data-i18n="language_selector.zh">Mandarin</option>
                        </select>
                    </div>
                    <div class="search-bar">
                        <form role="search" class="flex">
                            <input type="text" data-i18n="[placeholder]header.search.placeholder" placeholder="Search OHS Tools..." aria-label="Search OHS Tools" class="px-3 py-1 border border-gray-300 rounded-l text-gray-800">
                            <button type="submit" aria-label="Search" data-i18n="header.search.button" class="px-4 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-r">Search</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2 data-i18n="sidebar.ohs_tools">SafetyHelp OHS Tools</h2>
        <ul class="space-y-2">
            <li><a href="/safety-plans/pages/construction-compliance.html" data-i18n="sidebar.construction_safety" class="active">Construction Safety</a></li>
            <li><a href="/safety-plans/pages/emergency-response-plan.html" data-i18n="sidebar.emergency_planning">Emergency Planning</a></li>
            <li><a href="/safety-plans/pages/risk-assessment.html" data-i18n="sidebar.risk_assessment">Risk Assessment</a></li>
            <li><a href="/safety-plans/pages/legal-appointments.html" data-i18n="sidebar.legal_appointments">Legal Appointments</a></li>
            <li><a href="/safety-plans/pages/incident-management.html" data-i18n="sidebar.incident_management">Incident Management</a></li>
            <li><a href="/safety-plans/pages/training.html" data-i18n="sidebar.training">Training</a></li>
            <li><a href="/safety-plans/pages/inspections-audits.html" data-i18n="sidebar.inspections_audits">Inspections & Audits</a></li>
            <li><a href="/safety-plans/pages/suppliers.html" data-i18n="sidebar.suppliers">Suppliers</a></li>
            <li><a href="/safety-plans/pages/legislation.html" data-i18n="sidebar.legislation">Legislation</a></li>
            <li><a href="/safety-plans/pages/community-tools.html" data-i18n="sidebar.community_tools">Community Tools</a></li>
            <li><a href="/safety-plans/pages/member-dashboard.html" data-i18n="sidebar.member_dashboard">Member Dashboard</a></li>
            <li><a href="/safety-plans/pages/ohs-system.html" data-i18n="sidebar.ohs_system">OHS System</a></li>
        </ul>
        <div id="sidebar-step-info" class="step-info">
            <h3 data-i18n="sidebar.step_0.title">📜 Welcome to SafetyHelp</h3>
            <p data-i18n="sidebar.step_0.description" class="text-sm mb-3">Explore our comprehensive tools and resources to enhance occupational health and safety in your workplace.</p>
            <p class="fun-fact text-sm" data-i18n="sidebar.step_0.fun_fact">⚡ Did you know using reputable ethical suppliers can reduce workplace hazards by ensuring work is done on time and to the highest quality and safety standards?</p>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Intro Section -->
        <section class="intro">
            <h2 class="text-2xl font-bold mb-4" data-i18n="intro.title">Construction Health and Safety</h2>
            <p class="text-gray-600 mb-4" data-i18n="intro.description">Ensure compliance with construction health and safety regulations using Salatiso OHS Tools. Our resources help you manage risks, comply with legal requirements, and protect workers on-site, drawing from best practices outlined in "Safety First: The Essentials of OHS Plans."</p>
            <p class="text-gray-600" data-i18n="intro.download_link">Download the Construction OHS Plan: <a href="/safety-plans/python-script/OHS_Plan_Fillable.pdf" class="text-blue-500 hover:underline">Click Here</a></p>

            <div class="legal-obligations mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="legal-card bg-white border border-gray-200 rounded-lg p-4 shadow hover:shadow-md transition-shadow">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="legal_obligations.client.title">Client Obligations</h3>
                    <p class="text-sm text-gray-600 mb-2" data-i18n="legal_obligations.client.reg_5_1_a"><strong>Reg 5(1)(a):</strong> Prepare Baseline Risk Assessment (BRA).</p>
                    <p class="text-sm text-gray-600 mb-2" data-i18n="legal_obligations.client.reg_5_1_b"><strong>Reg 5(1)(b):</strong> Provide H&S Specification.</p>
                    <p class="text-sm text-gray-600" data-i18n="legal_obligations.client.reg_5_1_l"><strong>Reg 5(1)(l):</strong> Approve Contractor’s H&S Plan.</p>
                </div>
                <div class="legal-card bg-white border border-gray-200 rounded-lg p-4 shadow hover:shadow-md transition-shadow">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="legal_obligations.contractor.title">Contractor Obligations</h3>
                    <p class="text-sm text-gray-600 mb-2" data-i18n="legal_obligations.contractor.reg_7_1_a"><strong>Reg 7(1)(a):</strong> Develop H&S Plan.</p>
                    <p class="text-sm text-gray-600 mb-2" data-i18n="legal_obligations.contractor.reg_7_1_b"><strong>Reg 7(1)(b):</strong> Maintain H&S File on-site.</p>
                    <p class="text-sm text-gray-600" data-i18n="legal_obligations.contractor.reg_9"><strong>Reg 9:</strong> Conduct task HIRAs.</p>
                </div>
                <div class="legal-card bg-white border border-gray-200 rounded-lg p-4 shadow hover:shadow-md transition-shadow">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="legal_obligations.professional.title">H&S Professional Obligations</h3>
                    <p class="text-sm text-gray-600 mb-2" data-i18n="legal_obligations.professional.reg_5_5"><strong>Reg 5(5):</strong> PrCHSA manages H&S for Client.</p>
                    <p class="text-sm text-gray-600 mb-2" data-i18n="legal_obligations.professional.reg_8_5"><strong>Reg 8(5):</strong> CHSO assists Contractor.</p>
                    <p class="text-sm text-gray-600" data-i18n="legal_obligations.professional.sacpcmp"><strong>SACPCMP:</strong> Maintain registration & CPD.</p>
                </div>
            </div>

            <div class="action-buttons mt-6 flex flex-wrap gap-3">
                <button onclick="startWizard('hs-spec')" data-i18n="action_buttons.hs_spec" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Compile H&S Specification</button>
                <button onclick="startWizard('hs-plan')" data-i18n="action_buttons.hs_plan" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Compile H&S Plan</button>
                <button onclick="startWizard('risk-assessment')" data-i18n="action_buttons.risk_assessment" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Compile Risk Assessment</button>
                <button onclick="startWizard('training')" data-i18n="action_buttons.training" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Conduct Training</button>
                <button onclick="startWizard('appointments')" data-i18n="action_buttons.appointments" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Make Legal Appointments</button>
                <button onclick="startWizard('inspections')" data-i18n="action_buttons.inspections" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Conduct Inspections/Audits</button>
                <button onclick="startWizard('incidents')" data-i18n="action_buttons.incidents" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Manage Incidents</button>
                <button onclick="startWizard('reports')" data-i18n="action_buttons.reports" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Compile Reports</button>
                <button onclick="startWizard('hs-file')" data-i18n="action_buttons.hs_file" class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded shadow transition duration-300">Compile H&S File</button>
            </div>

            <div id="wizard-container" class="mt-6 bg-white p-6 rounded-lg shadow-md flex flex-col md:flex-row gap-6 hidden">
                <div id="wizard-content" class="flex-grow">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Compliance Wizard</h3>
                    <div id="progress-bar" class="progress-bar w-full bg-gray-200 rounded-full h-2.5 mb-4">
                        <div id="progress-fill" class="progress-fill bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <div id="step-content">
                        <!-- Step 0: Initial Prompt -->
                        <div id="step-0" class="step">
                            <p data-i18n="wizard.step_0">Please select an action to start the process.</p>
                        </div>
                        <!-- Step 1: Select Documents -->
                        <div id="step-1" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_1.title">Step 1 of 9: What do you want to do?</h4>
                            <div class="form-group">
                                <label data-i18n="wizard.step_1.label">Select the Documents you will Compile (Select all that apply):</label>
                                <table class="document-table w-full border-collapse mb-4">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="border border-gray-200 p-2 text-left text-sm font-semibold text-gray-700">Select</th>
                                            <th class="border border-gray-200 p-2 text-left text-sm font-semibold text-gray-700">Document</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="hs-spec" name="documents" value="hs-spec" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.hs_spec"><span class="emoji">📋</span> Health and Safety Specification</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="hs-plan" name="documents" value="hs-plan" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.hs_plan"><span class="emoji">📑</span> Health and Safety Plan</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="risk-assessment" name="documents" value="risk-assessment" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.risk_assessment"><span class="emoji">⚠️</span> Risk Assessment</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="training" name="documents" value="training" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.training"><span class="emoji">🎓</span> Conduct Training</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="appointments" name="documents" value="appointments" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.appointments"><span class="emoji">📜</span> Conduct Legal Appointments</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="inspections" name="documents" value="inspections" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.inspections"><span class="emoji">🔍</span> Conduct Inspections/Audits</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="incidents" name="documents" value="incidents" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.incidents"><span class="emoji">🚑</span> Manage Incidents</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="reports" name="documents" value="reports" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.reports"><span class="emoji">📊</span> Compliance Reports</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-200 p-2">
                                                <input type="checkbox" id="hs-file" name="documents" value="hs-file" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                            </td>
                                            <td class="border border-gray-200 p-2 document-name" data-i18n="wizard.step_1.hs_file"><span class="emoji">📂</span> Health and Safety File</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <p id="documents-error" class="error hidden" data-i18n="wizard.step_1.error">Please select at least one document to compile.</p>
                            </div>
                        </div>
                        <!-- Step 2: Client Details -->
                        <div id="step-2" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_2.title">Step 2 of 9: Client Details</h4>
                            <div class="form-group">
                                <label for="client-name" data-i18n="wizard.step_2.client_name_label">Client Company Name:</label>
                                <input type="text" id="client-name" name="client-name" required>
                                <p id="client-name-error" class="error hidden" data-i18n="wizard.step_2.client_name_error">Please enter the client company name.</p>
                            </div>
                            <div class="form-group">
                                <label for="client-address" data-i18n="wizard.step_2.client_address_label">Client Address:</label>
                                <input type="text" id="client-address" name="client-address" required>
                                <p id="client-address-error" class="error hidden" data-i18n="wizard.step_2.client_address_error">Please enter the client address.</p>
                            </div>
                            <div class="form-group">
                                <label for="client-contact-person" data-i18n="wizard.step_2.client_contact_person_label">Client Contact Person:</label>
                                <input type="text" id="client-contact-person" name="client-contact-person" required>
                                <p id="client-contact-person-error" class="error hidden" data-i18n="wizard.step_2.client_contact_person_error">Please enter the client contact person.</p>
                            </div>
                            <div class="form-group">
                                <label for="client-contact-role" data-i18n="wizard.step_2.client_contact_role_label">Client Contact Role:</label>
                                <input type="text" id="client-contact-role" name="client-contact-role" required>
                                <p id="client-contact-role-error" class="error hidden" data-i18n="wizard.step_2.client_contact_role_error">Please enter the client contact role.</p>
                            </div>
                            <div class="form-group">
                                <label for="client-contact-number" data-i18n="wizard.step_2.client_contact_number_label">Client Contact Number:</label>
                                <input type="tel" id="client-contact-number" name="client-contact-number" pattern="\+[0-9]{10,}" placeholder="+27123456789" required>
                                <p id="client-contact-number-error" class="error hidden" data-i18n="wizard.step_2.client_contact_number_error">Please enter a valid phone number (e.g., +27123456789).</p>
                            </div>
                            <div class="form-group">
                                <label for="client-email" data-i18n="wizard.step_2.client_email_label">Client Email:</label>
                                <input type="email" id="client-email" name="client-email" required>
                                <p id="client-email-error" class="error hidden" data-i18n="wizard.step_2.client_email_error">Please enter a valid email address.</p>
                            </div>
                            <div class="form-group">
                                <label for="client-coida" data-i18n="wizard.step_2.client_coida_label">COIDA Registration Number:</label>
                                <input type="text" id="client-coida" name="client-coida" required>
                                <p id="client-coida-error" class="error hidden" data-i18n="wizard.step_2.client_coida_error">Please enter the COIDA registration number.</p>
                            </div>
                        </div>
                        <!-- Step 3: Contractor Appointed -->
                        <div id="step-3" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_3.title">Step 3 of 9: Is a Contractor Appointed?</h4>
                            <div class="form-group">
                                <label for="contractor-appointed" data-i18n="wizard.step_3.contractor_appointed_label">Contractor Appointed:</label>
                                <select id="contractor-appointed" name="contractor-appointed" required>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="yes" data-i18n="wizard.step_3.option_yes">Yes</option>
                                    <option value="no" data-i18n="wizard.step_3.option_no">No</option>
                                    <option value="not-applicable" data-i18n="wizard.step_3.option_not_applicable">Not Applicable</option>
                                </select>
                                <p id="contractor-appointed-error" class="error hidden" data-i18n="wizard.step_3.contractor_appointed_error">Please select an option.</p>
                            </div>
                        </div>
                        <!-- Step 4: Contractor Details -->
                        <div id="step-4" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_4.title">Step 4 of 9: Contractor Details</h4>
                            <div class="form-group">
                                <label for="contractor-name" data-i18n="wizard.step_4.contractor_name_label">Contractor Company Name:</label>
                                <input type="text" id="contractor-name" name="contractor-name" required>
                                <p id="contractor-name-error" class="error hidden" data-i18n="wizard.step_4.contractor_name_error">Please enter the contractor company name.</p>
                            </div>
                            <div class="form-group">
                                <label for="contractor-address" data-i18n="wizard.step_4.contractor_address_label">Contractor Address:</label>
                                <input type="text" id="contractor-address" name="contractor-address" required>
                                <p id="contractor-address-error" class="error hidden" data-i18n="wizard.step_4.contractor_address_error">Please enter the contractor address.</p>
                            </div>
                            <div class="form-group">
                                <label for="contractor-contact-person" data-i18n="wizard.step_4.contractor_contact_person_label">Contractor Contact Person:</label>
                                <input type="text" id="contractor-contact-person" name="contractor-contact-person" required>
                                <p id="contractor-contact-person-error" class="error hidden" data-i18n="wizard.step_4.contractor_contact_person_error">Please enter the contractor contact person.</p>
                            </div>
                            <div class="form-group">
                                <label for="contractor-contact-role" data-i18n="wizard.step_4.contractor_contact_role_label">Contractor Contact Role:</label>
                                <input type="text" id="contractor-contact-role" name="contractor-contact-role" required>
                                <p id="contractor-contact-role-error" class="error hidden" data-i18n="wizard.step_4.contractor_contact_role_error">Please enter the contractor contact role.</p>
                            </div>
                            <div class="form-group">
                                <label for="contractor-contact-number" data-i18n="wizard.step_4.contractor_contact_number_label">Contractor Contact Number:</label>
                                <input type="tel" id="contractor-contact-number" name="contractor-contact-number" pattern="\+[0-9]{10,}" placeholder="+27123456789" required>
                                <p id="contractor-contact-number-error" class="error hidden" data-i18n="wizard.step_4.contractor_contact_number_error">Please enter a valid phone number (e.g., +27123456789).</p>
                            </div>
                            <div class="form-group">
                                <label for="contractor-email" data-i18n="wizard.step_4.contractor_email_label">Contractor Email:</label>
                                <input type="email" id="contractor-email" name="contractor-email" required>
                                <p id="contractor-email-error" class="error hidden" data-i18n="wizard.step_4.contractor_email_error">Please enter a valid email address.</p>
                            </div>
                            <div class="form-group">
                                <label for="contractor-coida" data-i18n="wizard.step_4.contractor_coida_label">COIDA Registration Number:</label>
                                <input type="text" id="contractor-coida" name="contractor-coida" required>
                                <p id="contractor-coida-error" class="error hidden" data-i18n="wizard.step_4.contractor_coida_error">Please enter the COIDA registration number.</p>
                            </div>
                        </div>
                        <!-- Step 5: Project Details -->
                        <div id="step-5" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_5.title">Step 5 of 9: Project Details</h4>
                            <div class="form-group">
                                <label for="project-reference" data-i18n="wizard.step_5.project_reference_label">Project Reference Number:</label>
                                <input type="text" id="project-reference" name="project-reference">
                            </div>
                            <div class="form-group">
                                <label for="project-name" data-i18n="wizard.step_5.project_name_label">Project Name:</label>
                                <input type="text" id="project-name" name="project-name" required>
                                <p id="project-name-error" class="error hidden" data-i18n="wizard.step_5.project_name_error">Please enter the project name.</p>
                            </div>
                            <div class="form-group">
                                <label for="site-address" data-i18n="wizard.step_5.site_address_label">Site Address:</label>
                                <input type="text" id="site-address" name="site-address" required>
                                <p id="site-address-error" class="error hidden" data-i18n="wizard.step_5.site_address_error">Please enter the site address.</p>
                            </div>
                            <div class="form-group">
                                <label for="site-supervisor-name" data-i18n="wizard.step_5.site_supervisor_name_label">Site Supervisor Name:</label>
                                <input type="text" id="site-supervisor-name" name="site-supervisor-name" required>
                                <p id="site-supervisor-name-error" class="error hidden" data-i18n="wizard.step_5.site_supervisor_name_error">Please enter the site supervisor name.</p>
                            </div>
                            <div class="form-group">
                                <label for="site-supervisor-number" data-i18n="wizard.step_5.site_supervisor_number_label">Site Supervisor Contact Number:</label>
                                <input type="tel" id="site-supervisor-number" name="site-supervisor-number" pattern="\+[0-9]{10,}" placeholder="+27123456789" required>
                                <p id="site-supervisor-number-error" class="error hidden" data-i18n="wizard.step_5.site_supervisor_number_error">Please enter a valid phone number (e.g., +27123456789).</p>
                            </div>
                            <div class="form-group">
                                <label for="site-supervisor-email" data-i18n="wizard.step_5.site_supervisor_email_label">Site Supervisor Email:</label>
                                <input type="email" id="site-supervisor-email" name="site-supervisor-email" required>
                                <p id="site-supervisor-email-error" class="error hidden" data-i18n="wizard.step_5.site_supervisor_email_error">Please enter a valid email address.</p>
                            </div>
                        </div>
                        <!-- Step 6: Project Scope -->
                        <div id="step-6" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_6.title">Step 6 of 9: Project Scope</h4>
                            <div class="form-group">
                                <label for="type-of-work" data-i18n="wizard.step_6.type_of_work_label">Type of Work to be Performed:</label>
                                <input type="text" id="type-of-work" name="type-of-work" required>
                                <p id="type-of-work-error" class="error hidden" data-i18n="wizard.step_6.type_of_work_error">Please enter the type of work.</p>
                            </div>
                            <div class="form-group">
                                <label for="cidb-grade" data-i18n="wizard.step_6.cidb_grade_label">CIDB Grade:</label>
                                <select id="cidb-grade" name="cidb-grade" required>
                                    <option value="" disabled selected data-i18n="wizard.step_6.cidb_grade_not_applicable">Not Applicable</option>
                                    <option value="1" data-i18n="wizard.step_6.cidb_grade_1">Grade 1</option>
                                    <option value="2" data-i18n="wizard.step_6.cidb_grade_2">Grade 2</option>
                                    <option value="3" data-i18n="wizard.step_6.cidb_grade_3">Grade 3</option>
                                    <option value="4" data-i18n="wizard.step_6.cidb_grade_4">Grade 4</option>
                                    <option value="5" data-i18n="wizard.step_6.cidb_grade_5">Grade 5</option>
                                    <option value="6" data-i18n="wizard.step_6.cidb_grade_6">Grade 6</option>
                                    <option value="7" data-i18n="wizard.step_6.cidb_grade_7">Grade 7</option>
                                    <option value="8" data-i18n="wizard.step_6.cidb_grade_8">Grade 8</option>
                                    <option value="9" data-i18n="wizard.step_6.cidb_grade_9">Grade 9</option>
                                </select>
                                <p id="cidb-grade-error" class="error hidden" data-i18n="wizard.step_6.cidb_grade_error">Please select a CIDB grade.</p>
                            </div>
                            <div class="form-group">
                                <label for="project-cost" data-i18n="wizard.step_6.cost_label">Cost (R):</label>
                                <input type="number" id="project-cost" name="project-cost" min="0" step="0.01" required>
                                <p id="project-cost-error" class="error hidden" data-i18n="wizard.step_6.cost_error">Please enter a valid project cost (R).</p>
                            </div>
                            <div class="form-group">
                                <label for="project-duration" data-i18n="wizard.step_6.duration_label">Duration (Days):</label>
                                <input type="number" id="project-duration" name="project-duration" min="1" required>
                                <p id="project-duration-error" class="error hidden" data-i18n="wizard.step_6.duration_error">Please enter a valid duration (days).</p>
                            </div>
                            <div class="form-group">
                                <label data-i18n="wizard.step_6.activities_label">Involved Activities (Select all that apply):</label>
                                <div class="activities-categories space-y-4">
                                    <details>
                                        <summary class="bg-gray-100 hover:bg-gray-200">General Activities</summary>
                                        <div class="category-content grid grid-cols-1 md:grid-cols-2 gap-2">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="security-guards" name="activities" value="security-guards" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="security-guards" data-i18n="wizard.step_6.activities.security_guards">Security guards</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="night-work" name="activities" value="night-work" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="night-work" data-i18n="wizard.step_6.activities.night_work">Night Work</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="moving-traffic" name="activities" value="moving-traffic" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="moving-traffic" data-i18n="wizard.step_6.activities.moving_traffic">Moving Traffic Work</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="vibration-exposure" name="activities" value="vibration-exposure" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="vibration-exposure" data-i18n="wizard.step_6.activities.vibration_exposure">Vibration Exposure</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="noise-exposure" name="activities" value="noise-exposure" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="noise-exposure" data-i18n="wizard.step_6.activities.noise_exposure">Noise Exposure</label>
                                            </div>
                                        </div>
                                    </details>
                                    <details>
                                        <summary class="bg-gray-100 hover:bg-gray-200">Hazardous Activities</summary>
                                        <div class="category-content grid grid-cols-1 md:grid-cols-2 gap-2">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="welders" name="activities" value="welders" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="welders" data-i18n="wizard.step_6.activities.welders">Welders</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="welding" name="activities" value="welding" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="welding" data-i18n="wizard.step_6.activities.welding">Welding</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="hot-work" name="activities" value="hot-work" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="hot-work" data-i18n="wizard.step_6.activities.hot_work">Hot Work (e.g., cutting, grinding)</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="combustible-materials" name="activities" value="combustible-materials" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="combustible-materials" data-i18n="wizard.step_6.activities.combustible_materials">Combustible Materials</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="hazardous-substances" name="activities" value="hazardous-substances" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="hazardous-substances" data-i18n="wizard.step_6.activities.hazardous_substances">Handling Hazardous Substances</label>
                                            </div>
                                        </div>
                                    </details>
                                    <details>
                                        <summary class="bg-gray-100 hover:bg-gray-200">Office/Workplace Specific</summary>
                                        <div class="category-content grid grid-cols-1 md:grid-cols-2 gap-2">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="office-fit-out" name="activities" value="office-fit-out" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="office-fit-out" data-i18n="wizard.step_6.activities.office_fit_out">Office Fit-Out</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="sensitive-it-equipment" name="activities" value="sensitive-it-equipment" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="sensitive-it-equipment" data-i18n="wizard.step_6.activities.sensitive_it_equipment">Sensitive IT Equipment</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="manual-handling" name="activities" value="manual-handling" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="manual-handling" data-i18n="wizard.step_6.activities.manual_handling">Manual Handling</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="working-electricity" name="activities" value="working-electricity" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="working-electricity" data-i18n="wizard.step_6.activities.working_electricity">Electricity Work</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="dust-exposure" name="activities" value="dust-exposure" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="dust-exposure" data-i18n="wizard.step_6.activities.dust_exposure">Dust Exposure</label>
                                            </div>
                                        </div>
                                    </details>
                                    <details>
                                        <summary class="bg-gray-100 hover:bg-gray-200">Construction Specific</summary>
                                        <div class="category-content grid grid-cols-1 md:grid-cols-2 gap-2">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="civil-contractors" name="activities" value="civil-contractors" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="civil-contractors" data-i18n="wizard.step_6.activities.civil_contractors">Civil Contractors</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="excavation" name="activities" value="excavation" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="excavation" data-i18n="wizard.step_6.activities.excavation">Excavation</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="crane-operations" name="activities" value="crane-operations" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="crane-operations" data-i18n="wizard.step_6.activities.crane_operations">Crane Operations</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="working-near-water" name="activities" value="working-near-water" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="working-near-water" data-i18n="wizard.step_6.activities.working_near_water">Work Near Water</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="pile-driving" name="activities" value="pile-driving" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="pile-driving" data-i18n="wizard.step_6.activities.pile_driving">Pile Driving</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="working-tunnels" name="activities" value="working-tunnels" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="working-tunnels" data-i18n="wizard.step_6.activities.working_tunnels">Tunnel Work</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="general-construction" name="activities" value="general-construction" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="general-construction" data-i18n="wizard.step_6.activities.general_construction">General Construction</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="working-from-heights" name="activities" value="working-from-heights" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="working-from-heights" data-i18n="wizard.step_6.activities.working_from_heights">Working from Heights</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="scaffolding" name="activities" value="scaffolding" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="scaffolding" data-i18n="wizard.step_6.activities.scaffolding">Scaffolding</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="multi-storey" name="activities" value="multi-storey" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="multi-storey" data-i18n="wizard.step_6.activities.multi_storey">Multi-Storey Construction</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="asbestos" name="activities" value="asbestos" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="asbestos" data-i18n="wizard.step_6.activities.asbestos">Asbestos Removal</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="confined-space" name="activities" value="confined-space" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="confined-space" data-i18n="wizard.step_6.activities.confined_space">Confined Space Entry</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="demolition" name="activities" value="demolition" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="demolition" data-i18n="wizard.step_6.activities.demolition">Demolition</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="roof-work" name="activities" value="roof-work" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="roof-work" data-i18n="wizard.step_6.activities.roof_work">Roof Work</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="temporary-works" name="activities" value="temporary-works" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="temporary-works" data-i18n="wizard.step_6.activities.temporary_works">Temporary Works</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="live-voltage" name="activities" value="live-voltage" class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="live-voltage" data-i18n="wizard.step_6.activities.live_voltage">Live Voltage Work</label>
                                            </div>
                                        </div>
                                    </details>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="scope-details" data-i18n="wizard.step_6.scope_details_label">Scope Details:</label>
                                <textarea id="scope-details" name="scope-details" rows="4" required></textarea>
                                <p id="scope-details-error" class="error hidden" data-i18n="wizard.step_6.scope_details_error">Please enter the scope details.</p>
                            </div>
                        </div>
                        <!-- Step 7: Compiled By -->
                        <div id="step-7" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_7.title">Step 7 of 9: Compiled By</h4>
                            <div class="form-group">
                                <label for="compiled-by-name" data-i18n="wizard.step_7.name_label">Name:</label>
                                <input type="text" id="compiled-by-name" name="compiled-by-name" required>
                                <p id="compiled-by-name-error" class="error hidden" data-i18n="wizard.step_7.name_error">Please enter your name.</p>
                            </div>
                            <div class="form-group">
                                <label for="compiled-by-number" data-i18n="wizard.step_7.number_label">Contact Number:</label>
                                <input type="tel" id="compiled-by-number" name="compiled-by-number" pattern="\+[0-9]{10,}" placeholder="+27123456789" required>
                                <p id="compiled-by-number-error" class="error hidden" data-i18n="wizard.step_7.number_error">Please enter a valid phone number (e.g., +27123456789).</p>
                            </div>
                            <div class="form-group">
                                <label for="compiled-by-email" data-i18n="wizard.step_7.email_label">Email:</label>
                                <input type="email" id="compiled-by-email" name="compiled-by-email" required>
                                <p id="compiled-by-email-error" class="error hidden" data-i18n="wizard.step_7.email_error">Please enter a valid email address.</p>
                            </div>
                            <div class="form-group">
                                <label for="compiled-by-role" data-i18n="wizard.step_7.role_label">Role:</label>
                                <select id="compiled-by-role" name="compiled-by-role" required>
                                    <option value="" disabled selected>Select Role</option>
                                    <option value="trainee" data-i18n="wizard.step_7.role_trainee">OHS Trainee</option>
                                    <option value="ohs-rep" data-i18n="wizard.step_7.role_ohs_rep">OHS Representative</option>
                                    <option value="sacpcmp-officer" data-i18n="wizard.step_7.role_sacpcmp_officer">SACPCMP Officer (CHSO)</option>
                                    <option value="sacpcmp-agent" data-i18n="wizard.step_7.role_sacpcmp_agent">SACPCMP Agent (PrCHSA)</option>
                                    <option value="other" data-i18n="wizard.step_7.role_other">Other</option>
                                </select>
                                <p id="compiled-by-role-error" class="error hidden" data-i18n="wizard.step_7.role_error">Please select a role.</p>
                            </div>
                            <div class="form-group hidden" id="sacpcmp-reg-group">
                                <label for="sacpcmp-reg" data-i18n="wizard.step_7.sacpcmp_reg_label">SACPCMP Registration Number:</label>
                                <input type="text" id="sacpcmp-reg" name="sacpcmp-reg">
                                <p id="sacpcmp-reg-error" class="error hidden" data-i18n="wizard.step_7.sacpcmp_reg_error">Please enter the SACPCMP registration number.</p>
                            </div>
                            <div class="form-group hidden" id="specify-role-group">
                                <label for="specify-role" data-i18n="wizard.step_7.specify_role_label">Specify Role:</label>
                                <input type="text" id="specify-role" name="specify-role">
                                <p id="specify-role-error" class="error hidden" data-i18n="wizard.step_7.specify_role_error">Please specify your role.</p>
                            </div>
                        </div>
                        <!-- Step 8: Compiled For -->
                        <div id="step-8" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_8.title">Step 8 of 9: Compiled For</h4>
                            <div class="form-group">
                                <label for="compiled-for" data-i18n="wizard.step_8.compiled_for_label">Compiled For:</label>
                                <select id="compiled-for" name="compiled-for" required>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="client" data-i18n="wizard.step_8.option_client">Client</option>
                                    <option value="contractor" data-i18n="wizard.step_8.option_contractor">Contractor</option>
                                    <option value="other" data-i18n="wizard.step_8.option_other">Other</option>
                                </select>
                                <p id="compiled-for-error" class="error hidden" data-i18n="wizard.step_8.compiled_for_error">Please select an option.</p>
                            </div>
                            <div class="form-group hidden" id="compiled-for-specify-group">
                                <label for="compiled-for-specify" data-i18n="wizard.step_8.specify_label">Specify:</label>
                                <input type="text" id="compiled-for-specify" name="compiled-for-specify">
                                <p id="compiled-for-specify-error" class="error hidden" data-i18n="wizard.step_8.specify_error">Please specify who the document is compiled for.</p>
                            </div>
                        </div>
                        <!-- Step 9: Review and Add to Cart -->
                        <div id="step-9" class="step hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-3" data-i18n="wizard.step_9.title">Step 9 of 9: Review and Add to Cart</h4>
                            <p data-i18n="wizard.step_9.description" class="text-gray-600 mb-4">Review your selections and add documents to your cart to proceed.</p>
                            <div class="form-group">
                                <label data-i18n="wizard.step_9.selected_documents_label" class="block text-sm font-medium text-gray-700 mb-2">Selected Documents:</label>
                                <ul id="selected-documents" class="list-disc list-inside text-gray-600"></ul>
                            </div>
                            <button id="add-to-cart-btn" data-i18n="wizard.nav.add_to_cart" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded shadow transition duration-300 mt-4">Add to Cart</button>
                        </div>
                    </div>
                    <div class="nav-buttons mt-6 flex justify-between">
                        <button id="back-btn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded shadow transition duration-300 disabled:opacity-50" data-i18n="wizard.nav.back" disabled>Back</button>
                        <button id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded shadow transition duration-300" data-i18n="wizard.nav.next">Next</button>
                    </div>
                </div>
                <div id="wizard-sidebar" class="w-full md:w-1/3 bg-gray-50 border border-gray-200 rounded-lg p-4 shadow-inner">
                    <h4 class="text-lg font-semibold text-gray-700 mb-3">Relevant Info</h4>
                    <div id="sidebar-legislation"></div>
                    <div id="sidebar-fun-fact" class="mt-4"></div>
                </div>
            </div>

            <div id="cart-container" class="cart-container mt-6 bg-white p-6 rounded-lg shadow-md hidden">
                <h3 data-i18n="cart.title" class="text-xl font-semibold text-gray-700 mb-4">Your Cart</h3>
                <p id="invoice-reference" class="hidden text-sm text-gray-600 mb-4" data-i18n="cart.invoice_reference">Invoice Reference Number: <span id="invoice-ref-number" class="font-medium"></span> (Valid for 7 days. Register to store indefinitely!)</p>
                <div class="overflow-x-auto">
                    <table id="cart-table" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th data-i18n="cart.table.document" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                <th data-i18n="cart.table.price" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                            </tr>
                        </thead>
                        <tbody id="cart-items" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
                <div class="checkout mt-6 flex items-center gap-4">
                    <label for="promo-code" data-i18n="cart.checkout.promo_label" class="text-sm font-medium text-gray-700">Promo Code:</label>
                    <input type="text" id="promo-code" data-i18n="[placeholder]cart.checkout.promo_placeholder" placeholder="Enter SAFETYFIRST25" aria-label="Promo Code" class="px-3 py-1 border border-gray-300 rounded-md shadow-sm text-sm">
                    <button id="checkout-btn" data-i18n="cart.checkout.button" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded shadow transition duration-300 text-sm">Checkout</button>
                </div>
            </div>

            <section class="resources mt-6 bg-white p-6 rounded-lg shadow-md mb-6">
                <h3 data-i18n="resources.title" class="text-xl font-semibold text-gray-700 mb-3">Contact Accredited H&S Professionals</h3>
                <p data-i18n="resources.description" class="text-gray-600 mb-4 text-sm">Need expert assistance? Reach out to accredited professionals for your project needs.</p>
                <ul class="space-y-2 text-sm">
                    <li data-i18n="resources.jane_doe" class="border-b border-gray-200 pb-2"><strong>Jane Doe, SACPCMP Agent (PrCHSA)</strong> - Reg No: PR12345 - Contact: <a href="mailto:jane.doe@example.com" class="text-blue-500 hover:underline">jane.doe@example.com</a></li>
                    <li data-i18n="resources.john_smith" class="border-b border-gray-200 pb-2"><strong>John Smith, SACPCMP Officer (CHSO)</strong> - Reg No: CHSO67890 - Contact: <a href="mailto:john.smith@example.com" class="text-blue-500 hover:underline">john.smith@example.com</a></li>
                    <li data-i18n="resources.emily_brown"><strong>Emily Brown, OHS Representative</strong> - Contact: <a href="mailto:emily.brown@example.com" class="text-blue-500 hover:underline">emily.brown@example.com</a></li>
                </ul>
            </section>

            <footer>
                <div class="container mx-auto px-6 text-center">
                    <p class="mb-2" data-i18n="footer.copyright">© 2025 SafetyHelp. All rights reserved.</p>
                    <p class="mb-4">
                        <a href="/safety-plans/privacy.html" data-i18n="footer.links.privacy" class="mx-2">Privacy Policy</a> |
                        <a href="/safety-plans/terms.html" data-i18n="footer.links.terms" class="mx-2">Terms of Service</a> |
                        <a href="/safety-plans/contact.html" data-i18n="footer.links.contact" class="mx-2">Contact Us</a>
                    </p>
                    <div class="newsletter mt-6">
                        <h3 class="text-lg font-semibold mb-3" data-i18n="footer.newsletter.title">Stay Updated</h3>
                        <form class="flex justify-center">
                            <input type="email" data-i18n="[placeholder]footer.newsletter.placeholder" placeholder="Enter your email" aria-label="Email for newsletter" class="px-3 py-2 border border-gray-300 rounded-l text-gray-800 w-64">
                            <button type="submit" data-i18n="footer.newsletter.button" class="px-4 py-2 rounded-r">Subscribe</button>
                        </form>
                    </div>
                </div>
            </footer>
        </div>

        <!-- Chatbot Container -->
        <div class="chatbot-container">
            <button id="chat-toggle" class="chat-toggle-btn p-3 rounded-full shadow-lg flex items-center justify-center">
                <span class="chat-icon text-2xl mr-1">⛑️</span> <span data-i18n="chatbot.button">Ask Me</span>
            </button>
            <div id="chat-window" class="chat-hidden bg-white border border-gray-300 rounded-lg shadow-xl">
                <div id="chat-output" class="p-3 text-sm h-80 overflow-y-scroll">
                    <p><strong>Chatbot:</strong> Hello! How can I help you with OHS today?</p>
                </div>
                <div id="chat-input-container" class="flex border-t border-gray-200">
                    <input id="chat-input" type="text" data-i18n="[placeholder]chatbot.input_placeholder" placeholder="Ask about OHS..." aria-label="Ask about OHS" class="flex-grow p-2 border-none focus:outline-none">
                    <button id="chat-send" aria-label="Send message" data-i18n="chatbot.send" class="px-4 py-2">Send</button>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
        <script>
            // Translation Initialization with Debugging
            document.addEventListener('DOMContentLoaded', async () => {
                const languages = ['en', 'af', 'zu', 'xh', 'st', 'tn', 'nso', 'ts', 'ss', 've', 'nr', 'es', 'fr', 'sn', 'sw'];
                const resources = {};

                // Load English translations as a fallback
                const defaultTranslations = {
                    "sidebar.ohs_tools": "SafetyHelp OHS Tools",
                    "sidebar.construction_safety": "Construction Safety",
                    "sidebar.emergency_planning": "Emergency Planning",
                    "sidebar.risk_assessment": "Risk Assessment",
                    "sidebar.legal_appointments": "Legal Appointments",
                    "sidebar.incident_management": "Incident Management",
                    "sidebar.training": "Training",
                    "sidebar.inspections_audits": "Inspections & Audits",
                    "sidebar.suppliers": "Suppliers",
                    "sidebar.legislation": "Legislation",
                    "sidebar.community_tools": "Community Tools",
                    "sidebar.member_dashboard": "Member Dashboard",
                    "sidebar.ohs_system": "OHS System",
                    "sidebar.step_0.title": "📜 Welcome to SafetyHelp",
                    "sidebar.step_0.description": "Explore our comprehensive tools and resources to enhance occupational health and safety in your workplace.",
                    "sidebar.step_0.fun_fact": "⚡ Did you know using reputable ethical suppliers can reduce workplace hazards by ensuring work is done on time and to the highest quality and safety standards?",
                    "intro.title": "Construction Health and Safety",
                    "intro.description": "Ensure compliance with construction health and safety regulations using Salatiso OHS Tools. Our resources help you manage risks, comply with legal requirements, and protect workers on-site, drawing from best practices outlined in 'Safety First: The Essentials of OHS Plans.'",
                    "intro.download_link": "Download the Construction OHS Plan: ",
                    "legal_obligations.client.title": "Client Obligations",
                    "legal_obligations.client.reg_5_1_a": "<strong>Reg 5(1)(a):</strong> Prepare Baseline Risk Assessment (BRA).",
                    "legal_obligations.client.reg_5_1_b": "<strong>Reg 5(1)(b):</strong> Provide H&S Specification.",
                    "legal_obligations.client.reg_5_1_l": "<strong>Reg 5(1)(l):</strong> Approve Contractor’s H&S Plan.",
                    "legal_obligations.contractor.title": "Contractor Obligations",
                    "legal_obligations.contractor.reg_7_1_a": "<strong>Reg 7(1)(a):</strong> Develop H&S Plan.",
                    "legal_obligations.contractor.reg_7_1_b": "<strong>Reg 7(1)(b):</strong> Maintain H&S File on-site.",
                    "legal_obligations.contractor.reg_9": "<strong>Reg 9:</strong> Conduct task HIRAs.",
                    "legal_obligations.professional.title": "H&S Professional Obligations",
                    "legal_obligations.professional.reg_5_5": "<strong>Reg 5(5):</strong> PrCHSA manages H&S for Client.",
                    "legal_obligations.professional.reg_8_5": "<strong>Reg 8(5):</strong> CHSO assists Contractor.",
                    "legal_obligations.professional.sacpcmp": "<strong>SACPCMP:</strong> Maintain registration & CPD.",
                    "action_buttons.hs_spec": "Compile H&S Specification",
                    "action_buttons.hs_plan": "Compile H&S Plan",
                    "action_buttons.risk_assessment": "Compile Risk Assessment",
                    "action_buttons.training": "Conduct Training",
                    "action_buttons.appointments": "Make Legal Appointments",
                    "action_buttons.inspections": "Conduct Inspections/Audits",
                    "action_buttons.incidents": "Manage Incidents",
                    "action_buttons.reports": "Compile Reports",
                    "action_buttons.hs_file": "Compile H&S File",
                    "resources.title": "Contact Accredited H&S Professionals",
                    "resources.description": "Need expert assistance? Reach out to accredited professionals for your project needs.",
                    "resources.jane_doe": "<strong>Jane Doe, SACPCMP Agent (PrCHSA)</strong> - Reg No: PR12345 - Contact: <a href='mailto:jane.doe@example.com' class='text-blue-500 hover:underline'>jane.doe@example.com</a>",
                    "resources.john_smith": "<strong>John Smith, SACPCMP Officer (CHSO)</strong> - Reg No: CHSO67890 - Contact: <a href='mailto:john.smith@example.com' class='text-blue-500 hover:underline'>john.smith@example.com</a>",
                    "resources.emily_brown": "<strong>Emily Brown, OHS Representative</strong> - Contact: <a href='mailto:emily.brown@example.com' class='text-blue-500 hover:underline'>emily.brown@example.com</a>",
                    "cart.title": "Your Cart",
                    "cart.invoice_reference": "Invoice Reference Number: <span id='invoice-ref-number' class='font-medium'></span> (Valid for 7 days. Register to store indefinitely!)",
                    "cart.table.document": "Document",
                    "cart.table.price": "Price",
                    "cart.checkout.promo_label": "Promo Code:",
                    "cart.checkout.promo_placeholder": "Enter SAFETYFIRST25",
                    "cart.checkout.button": "Checkout",
                    "wizard.step_0": "Please select an action to start the process.",
                    "wizard.step_1.title": "Step 1 of 9: What do you want to do?",
                    "wizard.step_1.label": "Select the Documents you will Compile (Select all that apply):",
                    "wizard.step_1.hs_spec": "<span class='emoji'>📋</span> Health and Safety Specification",
                    "wizard.step_1.hs_plan": "<span class='emoji'>📑</span> Health and Safety Plan",
                    "wizard.step_1.risk_assessment": "<span class='emoji'>⚠️</span> Risk Assessment",
                    "wizard.step_1.training": "<span class='emoji'>🎓</span> Conduct Training",
                    "wizard.step_1.appointments": "<span class='emoji'>📜</span> Conduct Legal Appointments",
                    "wizard.step_1.inspections": "<span class='emoji'>🔍</span> Conduct Inspections/Audits",
                    "wizard.step_1.incidents": "<span class='emoji'>🚑</span> Manage Incidents",
                    "wizard.step_1.reports": "<span class='emoji'>📊</span> Compliance Reports",
                    "wizard.step_1.hs_file": "<span class='emoji'>📂</span> Health and Safety File",
                    "wizard.step_1.error": "Please select at least one document to compile.",
                    "wizard.step_2.title": "Step 2 of 9: Client Details",
                    "wizard.step_2.client_name_label": "Client Company Name:",
                    "wizard.step_2.client_name_error": "Please enter the client company name.",
                    "wizard.step_2.client_address_label": "Client Address:",
                    "wizard.step_2.client_address_error": "Please enter the client address.",
                    "wizard.step_2.client_contact_person_label": "Client Contact Person:",
                    "wizard.step_2.client_contact_person_error": "Please enter the client contact person.",
                    "wizard.step_2.client_contact_role_label": "Client Contact Role:",
                    "wizard.step_2.client_contact_role_error": "Please enter the client contact role.",
                    "wizard.step_2.client_contact_number_label": "Client Contact Number:",
                    "wizard.step_2.client_contact_number_error": "Please enter a valid phone number (e.g., +27123456789).",
                    "wizard.step_2.client_email_label": "Client Email:",
                    "wizard.step_2.client_email_error": "Please enter a valid email address.",
                    "wizard.step_2.client_coida_label": "COIDA Registration Number:",
                    "wizard.step_2.client_coida_error": "Please enter the COIDA registration number.",
                    "wizard.step_3.title": "Step 3 of 9: Is a Contractor Appointed?",
                    "wizard.step_3.contractor_appointed_label": "Contractor Appointed:",
                    "wizard.step_3.option_yes": "Yes",
                    "wizard.step_3.option_no": "No",
                    "wizard.step_3.option_not_applicable": "Not Applicable",
                    "wizard.step_3.contractor_appointed_error": "Please select an option.",
                    "wizard.step_4.title": "Step 4 of 9: Contractor Details",
                    "wizard.step_4.contractor_name_label": "Contractor Company Name:",
                    "wizard.step_4.contractor_name_error": "Please enter the contractor company name.",
                    "wizard.step_4.contractor_address_label": "Contractor Address:",
                    "wizard.step_4.contractor_address_error": "Please enter the contractor address.",
                    "wizard.step_4.contractor_contact_person_label": "Contractor Contact Person:",
                    "wizard.step_4.contractor_contact_person_error": "Please enter the contractor contact person.",
                    "wizard.step_4.contractor_contact_role_label": "Contractor Contact Role:",
                    "wizard.step_4.contractor_contact_role_error": "Please enter the contractor contact role.",
                    "wizard.step_4.contractor_contact_number_label": "Contractor Contact Number:",
                    "wizard.step_4.contractor_contact_number_error": "Please enter a valid phone number (e.g., +27123456789).",
                    "wizard.step_4.contractor_email_label": "Contractor Email:",
                    "wizard.step_4.contractor_email_error": "Please enter a valid email address.",
                    "wizard.step_4.contractor_coida_label": "COIDA Registration Number:",
                    "wizard.step_4.contractor_coida_error": "Please enter the COIDA registration number.",
                    "wizard.step_5.title": "Step 5 of 9: Project Details",
                    "wizard.step_5.project_reference_label": "Project Reference Number:",
                    "wizard.step_5.project_name_label": "Project Name:",
                    "wizard.step_5.project_name_error": "Please enter the project name.",
                    "wizard.step_5.site_address_label": "Site Address:",
                    "wizard.step_5.site_address_error": "Please enter the site address.",
                    "wizard.step_5.site_supervisor_name_label": "Site Supervisor Name:",
                    "wizard.step_5.site_supervisor_name_error": "Please enter the site supervisor name.",
                    "wizard.step_5.site_supervisor_number_label": "Site Supervisor Contact Number:",
                    "wizard.step_5.site_supervisor_number_error": "Please enter a valid phone number (e.g., +27123456789).",
                    "wizard.step_5.site_supervisor_email_label": "Site Supervisor Email:",
                    "wizard.step_5.site_supervisor_email_error": "Please enter a valid email address.",
                    "wizard.step_6.title": "Step 6 of 9: Project Scope",
                    "wizard.step_6.type_of_work_label": "Type of Work to be Performed:",
                    "wizard.step_6.type_of_work_error": "Please enter the type of work.",
                    "wizard.step_6.cidb_grade_label": "CIDB Grade:",
                    "wizard.step_6.cidb_grade_not_applicable": "Not Applicable",
                    "wizard.step_6.cidb_grade_1": "Grade 1",
                    "wizard.step_6.cidb_grade_2": "Grade 2",
                    "wizard.step_6.cidb_grade_3": "Grade 3",
                    "wizard.step_6.cidb_grade_4": "Grade 4",
                    "wizard.step_6.cidb_grade_5": "Grade 5",
                    "wizard.step_6.cidb_grade_6": "Grade 6",
                    "wizard.step_6.cidb_grade_7": "Grade 7",
                    "wizard.step_6.cidb_grade_8": "Grade 8",
                    "wizard.step_6.cidb_grade_9": "Grade 9",
                    "wizard.step_6.cidb_grade_error": "Please select a CIDB grade.",
                    "wizard.step_6.cost_label": "Cost (R):",
                    "wizard.step_6.cost_error": "Please enter a valid project cost (R).",
                    "wizard.step_6.duration_label": "Duration (Days):",
                    "wizard.step_6.duration_error": "Please enter a valid duration (days).",
                    "wizard.step_6.activities_label": "Involved Activities (Select all that apply):",
                    "wizard.step_6.activities.security_guards": "Security guards",
                    "wizard.step_6.activities.night_work": "Night Work",
                    "wizard.step_6.activities.moving_traffic": "Moving Traffic Work",
                    "wizard.step_6.activities.vibration_exposure": "Vibration Exposure",
                    "wizard.step_6.activities.noise_exposure": "Noise Exposure",
                    "wizard.step_6.activities.welders": "Welders",
                    "wizard.step_6.activities.welding": "Welding",
                    "wizard.step_6.activities.hot_work": "Hot Work (e.g., cutting, grinding)",
                    "wizard.step_6.activities.combustible_materials": "Combustible Materials",
                    "wizard.step_6.activities.hazardous_substances": "Handling Hazardous Substances",
                    "wizard.step_6.activities.office_fit_out": "Office Fit-Out",
                    "wizard.step_6.activities.sensitive_it_equipment": "Sensitive IT Equipment",
                    "wizard.step_6.activities.manual_handling": "Manual Handling",
                    "wizard.step_6.activities.working_electricity": "Electricity Work",
                    "wizard.step_6.activities.dust_exposure": "Dust Exposure",
                    "wizard.step_6.activities.civil_contractors": "Civil Contractors",
                    "wizard.step_6.activities.excavation": "Excavation",
                    "wizard.step_6.activities.crane_operations": "Crane Operations",
                    "wizard.step_6.activities.working_near_water": "Work Near Water",
                    "wizard.step_6.activities.pile_driving": "Pile Driving",
                    "wizard.step_6.activities.working_tunnels": "Tunnel Work",
                    "wizard.step_6.activities.general_construction": "General Construction",
                    "wizard.step_6.activities.working_from_heights": "Working from Heights",
                    "wizard.step_6.activities.scaffolding": "Scaffolding",
                    "wizard.step_6.activities.multi_storey": "Multi-Storey Construction",
                    "wizard.step_6.activities.asbestos": "Asbestos Removal",
                    "wizard.step_6.activities.confined_space": "Confined Space Entry",
                    "wizard.step_6.activities.demolition": "Demolition",
                    "wizard.step_6.activities.roof_work": "Roof Work",
                    "wizard.step_6.activities.temporary_works": "Temporary Works",
                    "wizard.step_6.activities.live_voltage": "Live Voltage Work",
                    "wizard.step_6.scope_details_label": "Scope Details:",
                    "wizard.step_6.scope_details_error": "Please enter the scope details.",
                    "wizard.step_7.title": "Step 7 of 9: Compiled By",
                    "wizard.step_7.name_label": "Name:",
                    "wizard.step_7.name_error": "Please enter your name.",
                    "wizard.step_7.number_label": "Contact Number:",
                    "wizard.step_7.number_error": "Please enter a valid phone number (e.g., +27123456789).",
                    "wizard.step_7.email_label": "Email:",
                    "wizard.step_7.email_error": "Please enter a valid email address.",
                    "wizard.step_7.role_label": "Role:",
                    "wizard.step_7.role_trainee": "OHS Trainee",
                    "wizard.step_7.role_ohs_rep": "OHS Representative",
                    "wizard.step_7.role_sacpcmp_officer": "SACPCMP Officer (CHSO)",
                    "wizard.step_7.role_sacpcmp_agent": "SACPCMP Agent (PrCHSA)",
                    "wizard.step_7.role_other": "Other",
                    "wizard.step_7.role_error": "Please select a role.",
                    "wizard.step_7.sacpcmp_reg_label": "SACPCMP Registration Number:",
                    "wizard.step_7.sacpcmp_reg_error": "Please enter the SACPCMP registration number.",
                    "wizard.step_7.specify_role_label": "Specify Role:",
                    "wizard.step_7.specify_role_error": "Please specify your role.",
                    "wizard.step_8.title": "Step 8 of 9: Compiled For",
                    "wizard.step_8.compiled_for_label": "Compiled For:",
                    "wizard.step_8.option_client": "Client",
                    "wizard.step_8.option_contractor": "Contractor",
                    "wizard.step_8.option_other": "Other",
                    "wizard.step_8.compiled_for_error": "Please select an option.",
                    "wizard.step_8.specify_label": "Specify:",
                    "wizard.step_8.specify_error": "Please specify who the document is compiled for.",
                    "wizard.step_9.title": "Step 9 of 9: Review and Add to Cart",
                    "wizard.step_9.description": "Review your selections and add documents to your cart to proceed.",
                    "wizard.step_9.selected_documents_label": "Selected Documents:",
                    "wizard.nav.back": "Back",
                    "wizard.nav.next": "Next",
                    "wizard.nav.add_to_cart": "Add to Cart",
                    "footer.copyright": "© 2025 SafetyHelp. All rights reserved.",
                    "footer.links.privacy": "Privacy Policy",
                    "footer.links.terms": "Terms of Service",
                    "footer.links.contact": "Contact Us",
                    "footer.newsletter.title": "Stay Updated",
                    "footer.newsletter.placeholder": "Enter your email",
                    "footer.newsletter.button": "Subscribe",
                    "chatbot.button": "Ask Me",
                    "chatbot.input_placeholder": "Ask about OHS...",
                    "chatbot.send": "Send"
                };
                resources['en'] = { translation: defaultTranslations };

                // Attempt to load translations for all languages
                for (const lang of languages) {
                    if (lang === 'en') continue; // Skip English as it's already added
                    try {
                        const response = await fetch(`/safety-plans/assets/locales/${lang}/translation.json`);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const data = await response.json();
                        resources[lang] = { translation: data };
                        console.log(`Loaded translations for ${lang}:`, data);
                    } catch (error) {
                        console.error(`Failed to load translations for ${lang}:`, error);
                        // Fallback to English for this language
                        resources[lang] = { translation: defaultTranslations };
                    }
                }

                if (Object.keys(resources).length === 0) {
                    console.error("No translation files loaded. Using default English translations.");
                }

                await i18next.init({
                    lng: 'en',
                    resources,
                    fallbackLng: 'en',
                    debug: true
                });

                updateContent();

                document.getElementById('language-select').addEventListener('change', (e) => {
                    i18next.changeLanguage(e.target.value, (err) => {
                        if (err) {
                            console.error('Error changing language:', err);
                            return;
                        }
                        updateContent();
                    });
                });
            });

            function updateContent() {
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    const translation = i18next.t(key);
                    if (translation === key) {
                        console.warn(`Translation missing for key: ${key}`);
                    }
                    element.innerHTML = translation; // Use innerHTML to render HTML content in translations
                    console.log(`Translating ${key} to ${translation}`);
                });
            }

            // Wizard State Management
            let currentStep = 0;
            const totalSteps = 9;
            let selectedDocuments = [];
            let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
            let formData = {};

            // Initialize Wizard
            function startWizard(type) {
                selectedDocuments = [type];
                currentStep = 1;
                document.getElementById(`step-0`).classList.add('hidden');
                updateStep();
                document.getElementById('wizard-container').classList.remove('hidden');
                updateSidebar();
                updateProgressBar();
            }

            // Update Wizard Step
            function updateStep() {
                document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
                const currentStepElement = document.getElementById(`step-${currentStep}`);
                currentStepElement.classList.remove('hidden');

                document.getElementById('back-btn').disabled = currentStep === 1;
                document.getElementById('next-btn').textContent = currentStep === totalSteps ? 'Finish' : i18next.t('wizard.nav.next');

                // Handle dynamic fields based on selections
                if (currentStep === 1) {
                    document.querySelectorAll('input[name="documents"]').forEach(checkbox => {
                        checkbox.checked = selectedDocuments.includes(checkbox.value);
                    });
                } else if (currentStep === 4) {
                    const contractorAppointed = document.getElementById('contractor-appointed').value;
                    if (contractorAppointed === 'no' || contractorAppointed === 'not-applicable') {
                        currentStep = 5;
                        updateStep();
                    }
                } else if (currentStep === 7) {
                    const role = document.getElementById('compiled-by-role').value;
                    document.getElementById('sacpcmp-reg-group').classList.toggle('hidden', !['sacpcmp-officer', 'sacpcmp-agent'].includes(role));
                    document.getElementById('specify-role-group').classList.toggle('hidden', role !== 'other');
                } else if (currentStep === 8) {
                    const compiledFor = document.getElementById('compiled-for').value;
                    document.getElementById('compiled-for-specify-group').classList.toggle('hidden', compiledFor !== 'other');
                } else if (currentStep === 9) {
                    const selectedDocsList = document.getElementById('selected-documents');
                    selectedDocsList.innerHTML = '';
                    selectedDocuments.forEach(doc => {
                        const li = document.createElement('li');
                        li.textContent = i18next.t(`wizard.step_1.${doc}`);
                        selectedDocsList.appendChild(li);
                    });
                    document.getElementById('next-btn').classList.add('hidden');
                    document.getElementById('add-to-cart-btn').classList.remove('hidden');
                } else {
                    document.getElementById('next-btn').classList.remove('hidden');
                    document.getElementById('add-to-cart-btn').classList.add('hidden');
                }
            }

            // Update Progress Bar
            function updateProgressBar() {
                const progress = (currentStep / totalSteps) * 100;
                document.getElementById('progress-fill').style.width = `${progress}%`;
            }

            // Update Sidebar Content
            function updateSidebar() {
                const sidebarStepInfo = document.getElementById('sidebar-step-info');
                sidebarStepInfo.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2" data-i18n="sidebar.step_${currentStep}.title">Step ${currentStep}</h3>
                    <p class="text-sm mb-3" data-i18n="sidebar.step_${currentStep}.description">Description for step ${currentStep}</p>
                    <p class="fun-fact text-sm" data-i18n="sidebar.step_${currentStep}.fun_fact">Fun fact for step ${currentStep}</p>
                `;

                const sidebarLegislation = document.getElementById('sidebar-legislation');
                const sidebarFunFact = document.getElementById('sidebar-fun-fact');
                sidebarLegislation.innerHTML = '';
                sidebarFunFact.innerHTML = '';

                const legislation = getLegislationForStep(currentStep);
                if (legislation) {
                    const p = document.createElement('p');
                    p.className = 'text-sm text-gray-600';
                    p.innerHTML = legislation;
                    sidebarLegislation.appendChild(p);
                }

                const funFact = getFunFactForStep(currentStep);
                if (funFact) {
                    const p = document.createElement('p');
                    p.className = 'fun-fact text-sm';
                    p.innerHTML = `⚡ ${funFact}`;
                    sidebarFunFact.appendChild(p);
                }

                i18next.changeLanguage(i18next.language); // Trigger retranslation
            }

            // Get Legislation for Step
            function getLegislationForStep(step) {
                const legislationMap = {
                    1: '<strong>Construction Regulation 5:</strong> Clients must ensure all H&S requirements are specified.',
                    2: '<strong>Construction Regulation 5(1):</strong> Clients must provide detailed H&S specifications.',
                    3: '<strong>Construction Regulation 7:</strong> Contractors must be appointed with clear H&S plans.',
                    4: '<strong>Construction Regulation 7(1):</strong> Contractors must submit H&S plans.',
                    5: '<strong>Construction Regulation 3:</strong> Notification of construction work to DoL.',
                    6: '<strong>Construction Regulation 9:</strong> Risk assessments are mandatory for all activities.',
                    7: '<strong>SACPCMP Guidelines:</strong> Professionals must maintain registration.',
                    8: '<strong>OHS Act Section 16:</strong> Responsibilities must be clearly defined.',
                    9: '<strong>Construction Regulation 5(1)(l):</strong> Ensure all documents are approved.'
                };
                return legislationMap[step] || '';
            }

            // Get Fun Fact for Step
            function getFunFactForStep(step) {
                const funFacts = {
                    1: 'Selecting the right documents sets the foundation for compliance.',
                    2: 'Clear client details ensure effective communication.',
                    3: 'Appointing contractors early can streamline safety planning.',
                    4: 'Contractor details help in maintaining accountability.',
                    5: 'Accurate project details reduce risks significantly.',
                    6: 'Choosing the right scope can prevent unforeseen hazards.',
                    7: 'Your role ensures the document’s credibility.',
                    8: 'Defining the recipient helps tailor the document.',
                    9: 'Reviewing ensures no detail is missed!'
                };
                return funFacts[step] || '';
            }

            // Validate Current Step
            function validateStep() {
                let isValid = true;
                document.querySelectorAll('.error').forEach(error => error.classList.add('hidden'));

                if (currentStep === 1) {
                    selectedDocuments = [];
                    document.querySelectorAll('input[name="documents"]:checked').forEach(checkbox => {
                        selectedDocuments.push(checkbox.value);
                    });
                    if (selectedDocuments.length === 0) {
                        document.getElementById('documents-error').classList.remove('hidden');
                        isValid = false;
                    }
                } else if (currentStep === 2) {
                    const fields = [
                        { id: 'client-name', errorId: 'client-name-error' },
                        { id: 'client-address', errorId: 'client-address-error' },
                        { id: 'client-contact-person', errorId: 'client-contact-person-error' },
                        { id: 'client-contact-role', errorId: 'client-contact-role-error' },
                        { id: 'client-contact-number', errorId: 'client-contact-number-error' },
                        { id: 'client-email', errorId: 'client-email-error' },
                        { id: 'client-coida', errorId: 'client-coida-error' }
                    ];
                    fields.forEach(field => {
                        const input = document.getElementById(field.id);
                        if (!input.value) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        } else if (field.id === 'client-contact-number' && !/\+[0-9]{10,}/.test(input.value)) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        } else if (field.id === 'client-email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        }
                    });
                } else if (currentStep === 3) {
                    const contractorAppointed = document.getElementById('contractor-appointed').value;
                    if (!contractorAppointed) {
                        document.getElementById('contractor-appointed-error').classList.remove('hidden');
                        isValid = false;
                    }
                } else if (currentStep === 4) {
                    const fields = [
                        { id: 'contractor-name', errorId: 'contractor-name-error' },
                        { id: 'contractor-address', errorId: 'contractor-address-error' },
                        { id: 'contractor-contact-person', errorId: 'contractor-contact-person-error' },
                        { id: 'contractor-contact-role', errorId: 'contractor-contact-role-error' },
                        { id: 'contractor-contact-number', errorId: 'contractor-contact-number-error' },
                        { id: 'contractor-email', errorId: 'contractor-email-error' },
                        { id: 'contractor-coida', errorId: 'contractor-coida-error' }
                    ];
                    fields.forEach(field => {
                        const input = document.getElementById(field.id);
                        if (!input.value) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        } else if (field.id === 'contractor-contact-number' && !/\+[0-9]{10,}/.test(input.value)) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        } else if (field.id === 'contractor-email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        }
                    });
                } else if (currentStep === 5) {
                    const fields = [
                        { id: 'project-name', errorId: 'project-name-error' },
                        { id: 'site-address', errorId: 'site-address-error' },
                        { id: 'site-supervisor-name', errorId: 'site-supervisor-name-error' },
                        { id: 'site-supervisor-number', errorId: 'site-supervisor-number-error' },
                        { id: 'site-supervisor-email', errorId: 'site-supervisor-email-error' }
                    ];
                    fields.forEach(field => {
                        const input = document.getElementById(field.id);
                        if (!input.value) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        } else if (field.id === 'site-supervisor-number' && !/\+[0-9]{10,}/.test(input.value)) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        } else if (field.id === 'site-supervisor-email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
                            document.getElementById(field.errorId).classList.remove('hidden');
                            isValid = false;
                        }
                    });
                } else if (currentStep === 6) {
                    const typeOfWork = document.getElementById('type-of-work').value;
                    const cidbGrade = document.getElementById('cidb-grade').value;
                    const projectCost = document.getElementById('project-cost').value;
                    const projectDuration = document.getElementById('project-duration').value;
                    const scopeDetails = document.getElementById('scope-details').value;
                    if (!typeOfWork) {
                        document.getElementById('type-of-work-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (!cidbGrade) {
                        document.getElementById('cidb-grade-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (!projectCost || projectCost <= 0) {
                        document.getElementById('project-cost-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (!projectDuration || projectDuration <= 0) {
                        document.getElementById('project-duration-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (!scopeDetails) {
                        document.getElementById('scope-details-error').classList.remove('hidden');
                        isValid = false;
                    }
                } else if (currentStep === 7) {
                    const compiledByName = document.getElementById('compiled-by-name').value;
                    const compiledByNumber = document.getElementById('compiled-by-number').value;
                    const compiledByEmail = document.getElementById('compiled-by-email').value;
                    const compiledByRole = document.getElementById('compiled-by-role').value;
                    if (!compiledByName) {
                        document.getElementById('compiled-by-name-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (!compiledByNumber || !/\+[0-9]{10,}/.test(compiledByNumber)) {
                        document.getElementById('compiled-by-number-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (!compiledByEmail || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(compiledByEmail)) {
                        document.getElementById('compiled-by-email-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (!compiledByRole) {
                        document.getElementById('compiled-by-role-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (['sacpcmp-officer', 'sacpcmp-agent'].includes(compiledByRole)) {
                        const sacpcmpReg = document.getElementById('sacpcmp-reg').value;
                        if (!sacpcmpReg) {
                            document.getElementById('sacpcmp-reg-error').classList.remove('hidden');
                            isValid = false;
                        }
                    }
                    if (compiledByRole === 'other') {
                        const specifyRole = document.getElementById('specify-role').value;
                        if (!specifyRole) {
                            document.getElementById('specify-role-error').classList.remove('hidden');
                            isValid = false;
                        }
                    }
                } else if (currentStep === 8) {
                    const compiledFor = document.getElementById('compiled-for').value;
                    if (!compiledFor) {
                        document.getElementById('compiled-for-error').classList.remove('hidden');
                        isValid = false;
                    }
                    if (compiledFor === 'other') {
                        const compiledForSpecify = document.getElementById('compiled-for-specify').value;
                        if (!compiledForSpecify) {
                            document.getElementById('compiled-for-specify-error').classList.remove('hidden');
                            isValid = false;
                        }
                    }
                }
                return isValid;
            }

            // Navigation Handlers
            document.getElementById('next-btn').addEventListener('click', () => {
                if (validateStep()) {
                    if (currentStep < totalSteps) {
                        currentStep++;
                        updateStep();
                        updateProgressBar();
                        updateSidebar();
                    }
                }
            });

            document.getElementById('back-btn').addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateStep();
                    updateProgressBar();
                    updateSidebar();
                }
            });

            // Dynamic Field Handlers
            document.getElementById('contractor-appointed').addEventListener('change', (e) => {
                if (e.target.value === 'no' || e.target.value === 'not-applicable') {
                    currentStep = 5;
                    updateStep();
                }
            });

            document.getElementById('compiled-by-role').addEventListener('change', (e) => {
                const role = e.target.value;
                document.getElementById('sacpcmp-reg-group').classList.toggle('hidden', !['sacpcmp-officer', 'sacpcmp-agent'].includes(role));
                document.getElementById('specify-role-group').classList.toggle('hidden', role !== 'other');
            });

            document.getElementById('compiled-for').addEventListener('change', (e) => {
                document.getElementById('compiled-for-specify-group').classList.toggle('hidden', e.target.value !== 'other');
            });

            // Add to Cart and Compile Document
            document.getElementById('add-to-cart-btn').addEventListener('click', () => {
                formData = {
                    documents: selectedDocuments,
                    clientDetails: {
                        name: document.getElementById('client-name').value,
                        address: document.getElementById('client-address').value,
                        contactPerson: document.getElementById('client-contact-person').value,
                        contactRole: document.getElementById('client-contact-role').value,
                        contactNumber: document.getElementById('client-contact-number').value,
                        email: document.getElementById('client-email').value,
                        coida: document.getElementById('client-coida').value
                    },
                    contractorAppointed: document.getElementById('contractor-appointed').value,
                    contractorDetails: document.getElementById('contractor-appointed').value === 'yes' ? {
                        name: document.getElementById('contractor-name').value,
                        address: document.getElementById('contractor-address').value,
                        contactPerson: document.getElementById('contractor-contact-person').value,
                        contactRole: document.getElementById('contractor-contact-role').value,
                        contactNumber: document.getElementById('contractor-contact-number').value,
                        email: document.getElementById('contractor-email').value,
                        coida: document.getElementById('contractor-coida').value
                    } : null,
                    projectDetails: {
                        reference: document.getElementById('project-reference').value,
                        name: document.getElementById('project-name').value,
                        siteAddress: document.getElementById('site-address').value,
                        siteSupervisorName: document.getElementById('site-supervisor-name').value,
                        siteSupervisorNumber: document.getElementById('site-supervisor-number').value,
                        siteSupervisorEmail: document.getElementById('site-supervisor-email').value
                    },
                    projectScope: {
                        typeOfWork: document.getElementById('type-of-work').value,
                        cidbGrade: document.getElementById('cidb-grade').value,
                        cost: document.getElementById('project-cost').value,
                        duration: document.getElementById('project-duration').value,
                        activities: Array.from(document.querySelectorAll('input[name="activities"]:checked')).map(checkbox => checkbox.value),
                        scopeDetails: document.getElementById('scope-details').value
                    },
                    compiledBy: {
                        name: document.getElementById('compiled-by-name').value,
                        number: document.getElementById('compiled-by-number').value,
                        email: document.getElementById('compiled-by-email').value,
                        role: document.getElementById('compiled-by-role').value,
                        sacpcmpReg: document.getElementById('sacpcmp-reg')?.value || '',
                        specifyRole: document.getElementById('specify-role')?.value || ''
                    },
                    compiledFor: {
                        for: document.getElementById('compiled-for').value,
                        specify: document.getElementById('compiled-for-specify')?.value || ''
                    }
                };

                selectedDocuments.forEach(doc => {
                    if (!cartItems.some(item => item.document === doc)) {
                        cartItems.push({ document: doc, price: 'R100' });
                    }
                });

                localStorage.setItem('cartItems', JSON.stringify(cartItems));
                localStorage.setItem('formData', JSON.stringify(formData));
                displayCart();
                document.getElementById('wizard-container').classList.add('hidden');
                document.getElementById('cart-container').classList.remove('hidden');
            });

            // Display Cart
            function displayCart() {
                const cartItemsBody = document.getElementById('cart-items');
                cartItemsBody.innerHTML = '';
                cartItems.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="border border-gray-200 p-2">${i18next.t(`wizard.step_1.${item.document}`)}</td>
                        <td class="border border-gray-200 p-2">${item.price}</td>
                    `;
                    cartItemsBody.appendChild(row);
                });

                const invoiceRef = `INV-${Math.floor(Math.random() * 1000000)}`;
                document.getElementById('invoice-ref-number').textContent = invoiceRef;
                document.getElementById('invoice-reference').classList.remove('hidden');
            }

            // Compile Document as PDF
            function compileDocument(docType, formData) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let yOffset = 10;

                doc.setFontSize(16);
                doc.text(`${i18next.t(`wizard.step_1.${docType}`)}`, 10, yOffset);
                yOffset += 10;

                doc.setFontSize(12);
                doc.text('Client Details', 10, yOffset);
                yOffset += 10;
                doc.text(`Company Name: ${formData.clientDetails.name}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Address: ${formData.clientDetails.address}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Contact Person: ${formData.clientDetails.contactPerson}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Contact Role: ${formData.clientDetails.contactRole}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Contact Number: ${formData.clientDetails.contactNumber}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Email: ${formData.clientDetails.email}`, 10, yOffset);
                yOffset += 5;
                doc.text(`COIDA Registration: ${formData.clientDetails.coida}`, 10, yOffset);
                yOffset += 10;

                if (formData.contractorDetails) {
                    doc.text('Contractor Details', 10, yOffset);
                    yOffset += 10;
                    doc.text(`Company Name: ${formData.contractorDetails.name}`, 10, yOffset);
                    yOffset += 5;
                    doc.text(`Address: ${formData.contractorDetails.address}`, 10, yOffset);
                    yOffset += 5;
                    doc.text(`Contact Person: ${formData.contractorDetails.contactPerson}`, 10, yOffset);
                    yOffset += 5;
                    doc.text(`Contact Role: ${formData.contractorDetails.contactRole}`, 10, yOffset);
                    yOffset += 5;
                    doc.text(`Contact Number: ${formData.contractorDetails.contactNumber}`, 10, yOffset);
                    yOffset += 5;
                    doc.text(`Email: ${formData.contractorDetails.email}`, 10, yOffset);
                    yOffset += 5;
                    doc.text(`COIDA Registration: ${formData.contractorDetails.coida}`, 10, yOffset);
                    yOffset += 10;
                }

                doc.text('Project Details', 10, yOffset);
                yOffset += 10;
                doc.text(`Reference Number: ${formData.projectDetails.reference || 'N/A'}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Project Name: ${formData.projectDetails.name}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Site Address: ${formData.projectDetails.siteAddress}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Site Supervisor Name: ${formData.projectDetails.siteSupervisorName}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Site Supervisor Contact: ${formData.projectDetails.siteSupervisorNumber}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Site Supervisor Email: ${formData.projectDetails.siteSupervisorEmail}`, 10, yOffset);
                yOffset += 10;

                doc.text('Project Scope', 10, yOffset);
                yOffset += 10;
                doc.text(`Type of Work: ${formData.projectScope.typeOfWork}`, 10, yOffset);
                yOffset += 5;
                doc.text(`CIDB Grade: ${formData.projectScope.cidbGrade}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Cost (R): ${formData.projectScope.cost}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Duration (Days): ${formData.projectScope.duration}`, 10, yOffset);
                yOffset += 5;
                doc.text('Activities:', 10, yOffset);
                yOffset += 5;
                formData.projectScope.activities.forEach(activity => {
                    doc.text(`- ${i18next.t(`wizard.step_6.activities.${activity}`)}`, 15, yOffset);
                    yOffset += 5;
                });
                doc.text(`Scope Details: ${formData.projectScope.scopeDetails}`, 10, yOffset);
                yOffset += 10;

                doc.text('Compiled By', 10, yOffset);
                yOffset += 10;
                doc.text(`Name: ${formData.compiledBy.name}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Contact Number: ${formData.compiledBy.number}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Email: ${formData.compiledBy.email}`, 10, yOffset);
                yOffset += 5;
                doc.text(`Role: ${formData.compiledBy.role === 'other' ? formData.compiledBy.specifyRole : i18next.t(`wizard.step_7.role_${formData.compiledBy.role}`)}`, 10, yOffset);
                yOffset += 5;
                if (['sacpcmp-officer', 'sacpcmp-agent'].includes(formData.compiledBy.role)) {
                    doc.text(`SACPCMP Registration: ${formData.compiledBy.sacpcmpReg}`, 10, yOffset);
                    yOffset += 5;
                }

                doc.text('Compiled For', 10, yOffset);
                yOffset += 10;
                doc.text(`${formData.compiledFor.for === 'other' ? formData.compiledFor.specify : i18next.t(`wizard.step_8.option_${formData.compiledFor.for}`)}`, 10, yOffset);

                return doc;
            }

            // Checkout and Compile Documents
            document.getElementById('checkout-btn').addEventListener('click', () => {
                const promoCode = document.getElementById('promo-code').value;
                const formData = JSON.parse(localStorage.getItem('formData')) || {};

                cartItems.forEach(item => {
                    const doc = compileDocument(item.document, formData);
                    doc.save(`${item.document}.pdf`);
                });

                if (promoCode === 'SAFETYFIRST25') {
                    alert('Promo code applied! Your documents are free.');
                } else {
                    alert('Checkout successful! Documents have been compiled and downloaded.');
                }

                localStorage.removeItem('cartItems');
                localStorage.removeItem('formData');
                cartItems = [];
                displayCart();
                document.getElementById('cart-container').classList.add('hidden');
            });

            // Initial Cart Display
            if (cartItems.length > 0) {
                document.getElementById('cart-container').classList.remove('hidden');
                displayCart();
            }

            // Firebase and Chatbot
            const firebaseConfig = {
                apiKey: "YOUR_API_KEY",
                authDomain: "YOUR_AUTH_DOMAIN",
                projectId: "YOUR_PROJECT_ID",
                storageBucket: "YOUR_STORAGE_BUCKET",
                messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
                appId: "YOUR_APP_ID",
                measurementId: "YOUR_MEASUREMENT_ID"
            };

            let db;

            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log("Firebase Initialized Successfully");
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                const chatOutput = document.getElementById('chat-output');
                if (chatOutput) {
                    chatOutput.innerHTML += "<p class='text-red-600'><strong>Error:</strong> Chatbot unavailable due to configuration issue.</p>";
                }
                const chatInput = document.getElementById('chat-input');
                const chatSend = document.getElementById('chat-send');
                if (chatInput) chatInput.disabled = true;
                if (chatSend) chatSend.disabled = true;
            }

            const chatToggle = document.getElementById('chat-toggle');
            const chatWindow = document.getElementById('chat-window');
            const chatOutput = document.getElementById('chat-output');
            const chatInput = document.getElementById('chat-input');
            const chatSend = document.getElementById('chat-send');

            if (chatToggle) {
                chatToggle.addEventListener('click', () => {
                    chatWindow.classList.toggle('chat-hidden');
                    if (!chatWindow.classList.contains('chat-hidden')) {
                        chatInput.focus();
                    }
                });
            }

            function addChatMessage(sender, message) {
                if (chatOutput) {
                    const messageElement = document.createElement('p');
                    messageElement.classList.add('mb-2');
                    messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
                    chatOutput.appendChild(messageElement);
                    chatOutput.scrollTop = chatOutput.scrollHeight;
                }
            }

            async function sendQuery() {
                if (!db) {
                    addChatMessage('Chatbot', 'Sorry, the chatbot is currently unavailable.');
                    return;
                }

                const input = chatInput.value.trim();
                if (!input) return;

                addChatMessage('You', input);
                chatInput.value = '';
                addChatMessage('Chatbot', 'Searching...');

                const query = input.toLowerCase();

                try {
                    const snapshot = await db.collection('ohs-knowledge')
                        .where('keywords', 'array-contains', query)
                        .limit(1)
                        .get();

                    let responseFound = false;
                    let response = "Sorry, I couldn’t find specific information on that topic. Please try rephrasing or ask a different question.";

                    if (!snapshot.empty) {
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            response = `Based on information from ${data.book || 'our resources'} (Chapter ${data.chapter || 'N/A'}), here's a summary: <br>${data.content.substring(0, 250)}...`;
                            if (data.file) {
                                response += ` (See <a href="/safety-plans/resources/${data.file}" target="_blank" class="text-blue-500 hover:underline">full chapter</a>)`;
                            }
                            responseFound = true;
                        });
                    }

                    const searchingMessage = chatOutput.querySelector('p:last-child');
                    if(searchingMessage && searchingMessage.textContent.includes('Searching...')) {
                        searchingMessage.innerHTML = `<strong>Chatbot:</strong> ${response}`;
                    } else {
                        addChatMessage('Chatbot', response);
                    }
                } catch (error) {
                    console.error("Firestore query failed:", error);
                    const searchingMessage = chatOutput.querySelector('p:last-child');
                    if(searchingMessage && searchingMessage.textContent.includes('Searching...')) {
                        searchingMessage.innerHTML = `<strong>Chatbot:</strong> Oops, something went wrong while searching. Please try again!`;
                    } else {
                        addChatMessage('Chatbot', 'Oops, something went wrong while searching. Please try again!');
                    }
                }
            }

            if (chatSend) {
                chatSend.addEventListener('click', sendQuery);
            }
            if (chatInput) {
                chatInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        sendQuery();
                    }
                });
            }
        </script>
    </body>
</html>
