<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Generate detailed risk assessments with Safety First OHS Tools.">
    <meta name="keywords" content="risk assessment, OHS South Africa, construction safety">
    <meta name="author" content="Salatiso Lonwabo Mdeni">
    <title>Safety First OHS Tools | Risk Assessment</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .tool-container { max-width: 900px; margin: 20px auto; text-align: center; }
        .risk-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
        .risk-table th, .risk-table td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        .risk-table input { width: 100%; box-sizing: border-box; }
        .output { margin-top: 20px; }
        .download-btn { padding: 8px 16px; margin: 5px; background-color: #28a745; color: white; border: none; cursor: pointer; }
        .add-risk-btn { padding: 10px 20px; margin: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div class="sidebar">
        <button class="sidebar-trigger" aria-label="Toggle OHS Tools Menu">Tools</button>
        <div class="sidebar-content">
            <h3>OHS Tools</h3>
            <div class="tool-category">
                <button class="category-toggle">Compliance Tools</button>
                <div class="category-content">
                    <a href="pages/construction-compliance.html"><span class="icon">üèóÔ∏è</span> Construction Compliance</a>
                    <a href="pages/risk-assessment.html"><span class="icon">‚ö†Ô∏è</span> Risk Assessment</a>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <header>
            <h1>Safety First OHS Tools</h1>
            <nav>
                <a href="../index.html">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <div class="search-bar">
                    <form role="search">
                        <input type="text" placeholder="Search OHS Tools..." aria-label="Search OHS Tools">
                        <button type="submit" aria-label="Search">Search</button>
                    </form>
                </div>
            </nav>
        </header>

        <section class="intro">
            <h2>Risk Assessment Tool</h2>
            <p>Generate a detailed risk assessment for your construction project. Add and evaluate risks below.</p>
        </section>

        <section class="content tool-container">
            <form id="risk-input">
                <h3>Risk Assessment</h3>
                <table class="risk-table">
                    <thead>
                        <tr><th>Activity</th><th>Hazard</th><th>Effect</th><th>Controls</th><th>Freq</th><th>Prob</th><th>Rating</th></tr>
                    </thead>
                    <tbody id="risk-table-body"></tbody>
                </table>
                <button type="button" class="add-risk-btn" id="add-risk">Add Risk</button>
                <button type="submit">Generate Risk Assessment</button>
            </form>
            <div id="risk-output" class="output"></div>
        </section>

        <footer>
            <p>¬© 2025 Safety First OHS Tools. All rights reserved.</p>
            <p><a href="../privacy.html">Privacy Policy</a> | <a href="../terms.html">Terms of Service</a> | <a href="../contact.html">Contact Us</a></p>
        </footer>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        // Sidebar functionality
        document.querySelector('.sidebar-trigger').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('active');
            document.querySelector('.sidebar-content').classList.toggle('active');
        });
        document.querySelectorAll('.category-toggle').forEach(button => {
            button.addEventListener('click', function() {
                const content = this.nextElementSibling;
                content.classList.toggle('active');
                this.classList.toggle('active');
            });
        });

        // Pre-populated risks
        const risks = [
            { activity: "Painting", hazard: "Dust from sanding", effect: "Respiratory condition", controls: "RPE, Medical Exam", freq: 3, prob: 3, rating: 9 },
            { activity: "Painting", hazard: "Working at heights", effect: "Fall, Injury", controls: "Scaffolding, PPE", freq: 4, prob: 3, rating: 12 },
            { activity: "Excavation", hazard: "Trench collapse", effect: "Crushing injuries", controls: "Shoring, Inspections", freq: 4, prob: 4, rating: 16 },
            // Add more from your list later
        ];

        // Populate risk table
        const riskTableBody = document.getElementById('risk-table-body');
        risks.forEach(risk => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${risk.activity}</td><td>${risk.hazard}</td><td>${risk.effect}</td><td>${risk.controls}</td>
                <td><input type="number" min="1" max="5" value="${risk.freq}"></td>
                <td><input type="number" min="1" max="5" value="${risk.prob}"></td>
                <td>${risk.rating}</td>
            `;
            riskTableBody.appendChild(row);
        });

        // Add custom risk
        document.getElementById('add-risk').addEventListener('click', () => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" name="activity"></td>
                <td><input type="text" name="hazard"></td>
                <td><input type="text" name="effect"></td>
                <td><input type="text" name="controls"></td>
                <td><input type="number" min="1" max="5" value="1"></td>
                <td><input type="number" min="1" max="5" value="1"></td>
                <td>1</td>
            `;
            riskTableBody.appendChild(row);
        });

        // Risk form submission
        document.getElementById('risk-input').addEventListener('submit', (e) => {
            e.preventDefault();
            const customRisks = Array.from(riskTableBody.querySelectorAll('tr')).map(row => ({
                activity: row.cells[0].querySelector('input')?.value || row.cells[0].textContent,
                hazard: row.cells[1].querySelector('input')?.value || row.cells[1].textContent,
                effect: row.cells[2].querySelector('input')?.value || row.cells[2].textContent,
                controls: row.cells[3].querySelector('input')?.value || row.cells[3].textContent,
                freq: parseInt(row.cells[4].querySelector('input').value),
                prob: parseInt(row.cells[5].querySelector('input').value),
                rating: parseInt(row.cells[4].querySelector('input').value) * parseInt(row.cells[5].querySelector('input').value)
            }));

            const output = document.getElementById('risk-output');
            output.innerHTML = '<h4>Generated Document</h4>';

            const riskDoc = new jsPDF();
            riskDoc.text(`Detailed Risk Assessment`, 10, 10);
            let y = 20;
            customRisks.forEach((risk, i) => {
                riskDoc.text(`${i + 1}. ${risk.activity}: ${risk.hazard} - ${risk.effect} (Rating: ${risk.rating})`, 10, y);
                riskDoc.text(`   Controls: ${risk.controls}`, 10, y + 5);
                y += 15;
                if (y > 280) { riskDoc.addPage(); y = 10; }
            });
            output.innerHTML += '<button class="download-btn" onclick="downloadPDF(\'risk-assessment.pdf\', riskDoc)">Download Risk Assessment</button>';
        });

        // PDF Download Helper
        function downloadPDF(filename, doc) {
            doc.save(filename);
        }

        // Dynamic header adjustment
        window.addEventListener('load', adjustLayout);
        window.addEventListener('resize', adjustLayout);
        function adjustLayout() {
            const headerHeight = document.querySelector('header').offsetHeight;
            document.querySelector('.main-content').style.paddingTop = headerHeight + 'px';
            document.querySelector('.sidebar').style.top = headerHeight + 'px';
            document.querySelector('.sidebar').style.height = `calc(100% - ${headerHeight}px)`;
        }
    </script>
</body>
</html>
