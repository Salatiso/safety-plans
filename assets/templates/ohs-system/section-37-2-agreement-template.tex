\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper, margin=2.5cm]{geometry}
\usepackage{fancyhdr}
\usepackage{draftwatermark}
\usepackage{tocbibind}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{noto}
\usepackage{ifthen}

% Branding variables
\newcommand{\brandingLevel}{light}
\newcommand{\userLogo}{}
\newcommand{\userCompany}{{{COMPANY_NAME}}}
\newcommand{\safetyHelpLogo}{/safety-plans/assets/images/logo.png}
\SetWatermarkText{SafetyHelp}
\SetWatermarkScale{2}
\SetWatermarkColor[gray]{0.9}

% Dynamic fields
\newcommand{\docTitle}{Section 37(2) Agreement}
\newcommand{\refNumber}{S37-001}
\newcommand{\issueDate}{{{DATE}}}
\newcommand{\projectName}{{{PROJECT_NAME}}}
\newcommand{\clientName}{{{COMPANY_NAME}}}
\newcommand{\clientAddress}{{{COMPANY_ADDRESS}}}
\newcommand{\clientContact}{{{COMPANY_CONTACT}}, {{COMPANY_EMAIL}}}
\newcommand{\contractorName}{{{CONTRACTOR_NAME}}}
\newcommand{\contractorAddress}{{{CONTRACTOR_ADDRESS}}}
\newcommand{\contractorContact}{{{CONTRACTOR_CONTACT}}, {{CONTRACTOR_EMAIL}}}
\newcommand{\compilerName}{{{COMPILED_BY_NAME}}}
\newcommand{\compilerRole}{{{COMPILED_BY_ROLE}}}
\newcommand{\compilerSACPCMP}{{{SACPCMP_NUMBER}}}
\newcommand{\compilerEmail}{{{COMPILED_BY_EMAIL}}}
\newcommand{\compilerPhone}{{{COMPILED_BY_CONTACT}}}
\newcommand{\revision}{{{REVISION}}}
\newcommand{\reviewDate}{{{REVIEW_DATE}}}

% Header and Footer
\pagestyle{fancy}
\fancyhf{}
\ifthenelse{\equal{\brandingLevel}{heavy}}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}} \quad \includegraphics[height=1cm]{\safetyHelpLogo}}
  \fancyhead[R]{\small \compilerName}
  \SetWatermarkLightness{0.7}
}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}}}
  \fancyhead[R]{\small \compilerName}
}
\ifthenelse{\equal{\brandingLevel}{none}}{
  \SetWatermarkText{}
}{}
\fancyfoot[L]{\small \textit{Powered by SafetyHelp | Safety Personalized, Compliance Simplified}}
\fancyfoot[C]{\small \textit{Visit safetyfirst.help | Email: salatiso@safetyfirst.help}}
\fancyfoot[R]{\small Page \thepage\ of \pageref{LastPage}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}
\fancyfoot[C]{\parbox[b]{\textwidth}{\footnotesize \textit{This document is generated by SafetyHelp for OHS compliance. Verify applicability with local regulations.}}}

\begin{document}

% Cover Page
\begin{titlepage}
  \centering
  \ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light}}{
    \includegraphics[height=1.5cm,keepaspectratio]{\safetyHelpLogo}\hfill
  }{}
  \vspace{2cm}
  \ifthen\isempty{\userLogo}{\textbf{\Large \userCompany}\vspace{1cm}}{\includegraphics[height=1.5cm]{\userLogo}\vspace{1cm}}
  {\Huge \textbf{\docTitle}}\vspace{1cm}
  {\Large Reference: \refNumber}\vspace{0.5cm}
  {\large Issue Date: \issueDate}\vspace{0.5cm}
  {\large Review Date: \reviewDate}\vspace{0.5cm}
  {\large Project: \projectName}\vspace{0.5cm}
  {\large Client: \clientName, \clientAddress}\vspace{0.5cm}
  {\large Contractor: \contractorName, \contractorAddress}\vspace{0.5cm}
  {\large Compiled By: \compilerName, \compilerRole}\vspace{0.5cm}
  {\large \compilerEmail, \compilerPhone}
  \vspace{2cm}
  \rule{\textwidth}{0.5pt}
\end{titlepage}

% Table of Contents
\tableofcontents
\newpage

% Introduction
\section{Introduction}
\subsection{Purpose}
This Section 37(2) Agreement, in accordance with the Occupational Health and Safety Act 85 of 1993, establishes the responsibilities of \clientName\ (the Client) and \contractorName\ (the Contractor) to ensure compliance with health and safety regulations for the \projectName\ project.

\subsection{Scope}
This agreement applies to all activities performed by \contractorName\ on the \projectName\ project at \clientAddress.

% Compiled By Details
\section{Compiled By Details}
\begin{tabularx}{\textwidth}{lX}
  \toprule
  \textbf{Field} & \textbf{Details} \\
  \midrule
  Name & \compilerName \\
  Role & \compilerRole \\
  SACPCMP Number & \compilerSACPCMP \\
  Email & \compilerEmail \\
  Phone & \compilerPhone \\
  Date & \issueDate \\
  \bottomrule
\end{tabularx}

% Revision History
\section{Revision History}
\begin{tabularx}{\textwidth}{lXll}
  \toprule
  \textbf{Rev} & \textbf{Date} & \textbf{Changes} & \textbf{Revised By} \\
  \midrule
  \revision & \issueDate & Initial version & \compilerName \\
  \bottomrule
\end{tabularx}

% Agreement Details
\section{Agreement Details}
\subsection{Obligations of the Client}
\begin{itemize}
    \item Provide the Health and Safety Specification for the \projectName\ project.
    \item Ensure the Contractor is informed of all relevant hazards and risks.
    \item Monitor compliance with the Health and Safety Plan.
\end{itemize}

\subsection{Obligations of the Contractor}
\begin{itemize}
    \item Comply with the Occupational Health and Safety Act and its regulations.
    \item Develop and implement a Health and Safety Plan based on the provided specification.
    \item Ensure all employees are trained and competent.
    \item Maintain a Health and Safety File with all required documentation.
\end{itemize}

\subsection{Legal Compliance}
This agreement ensures compliance with Section 37(2) of the OHS Act, designating \contractorName\ as an employer responsible for OHS duties unless otherwise agreed.

% Signature Page
\section{Signature Page}
\begin{itemize}
  \item \textbf{Client Representative}: \\
    Name: \rule{5cm}{0.4pt} \quad Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
  \item \textbf{Contractor Representative}: \\
    Name: \rule{5cm}{0.4pt} \quad Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
  \item \textbf{Compiler}: \compilerName \\
    Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
\end{itemize}

% Back Page
\ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light} \OR \equal{\brandingLevel}{none}}{
  \newpage
  \section*{About SafetyHelp}
  SafetyHelp is South Africaâ€™s leading OHS platform, offering AI-powered tools for compliance, risk management, and safety education across industries like construction, mining, education, and healthcare.

  \textbf{Contact}: Visit \href{https://safetyfirst.help}{safetyfirst.help} or email \href{mailto:salatiso@safetyfirst.help}{salatiso@safetyfirst.help} to learn more.
  \vspace{2cm}
  \hfill \includegraphics[height=2cm]{\safetyHelpLogo}
}{}

\label{LastPage}
\end{document}
