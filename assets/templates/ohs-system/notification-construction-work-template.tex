\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper, margin=2.5cm]{geometry}
\usepackage{fancyhdr}
\usepackage{draftwatermark}
\usepackage{tocbibind}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{noto}
\usepackage{ifthen}

% Branding variables
\newcommand{\brandingLevel}{light}
司令{\userLogo}{}
\newcommand{\userCompany}{{{COMPANY_NAME}}}
\newcommand{\safetyHelpLogo}{/safety-plans/assets/images/logo.png}
\SetWatermarkText{SafetyHelp}
\SetWatermarkScale{2}
\SetWatermarkColor[gray]{0.9}

% Dynamic fields
\newcommand{\docTitle}{Notification of Construction Work}
\newcommand{\refNumber}{NCW-001}
\newcommand{\issueDate}{{{DATE}}}
\newcommand{\projectName}{{{PROJECT_NAME}}}
\newcommand{\siteAddress}{{{SITE_ADDRESS}}}
\newcommand{\projectDuration}{{{PROJECT_DURATION}}}
\newcommand{\clientName}{{{COMPANY_NAME}}}
\newcommand{\clientAddress}{{{COMPANY_ADDRESS}}}
\newcommand{\clientContact}{{{COMPANY_CONTACT}}, {{COMPANY_EMAIL}}}
\newcommand{\contractorName}{{{CONTRACTOR_NAME}}}
\newcommand{\contractorAddress}{{{CONTRACTOR_ADDRESS}}}
\newcommand{\contractorContact}{{{CONTRACTOR_CONTACT}}, {{CONTRACTOR_EMAIL}}}
\newcommand{\compilerName}{{{COMPILED_BY_NAME}}}
\newcommand{\compilerRole}{{{COMPILED_BY_ROLE}}}
\newcommand{\compilerSACPCMP}{{{SACPCMP_NUMBER}}}
\newcommand{\compilerEmail}{{{COMPILED_BY_EMAIL}}}
\newcommand{\compilerPhone}{{{COMPILED_BY_CONTACT}}}
\newcommand{\revision}{{{REVISION}}}
\newcommand{\notificationDate}{{{NOTIFICATION_DATE}}}

% Header and Footer
\pagestyle{fancy}
\fancyhf{}
\ifthenelse{\equal{\brandingLevel}{heavy}}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}} \quad \includegraphics[height=1cm]{\safetyHelpLogo}}
  \fancyhead[R]{\small \compilerName}
  \SetWatermarkLightness{0.7}
}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}}}
  \fancyhead[R]{\small \compilerName}
}
\ifthenelse{\equal{\brandingLevel}{none}}{
  \SetWatermarkText{}
}{}
\fancyfoot[L]{\small \textit{Powered by SafetyHelp | Safety Personalized, Compliance Simplified}}
\fancyfoot[C]{\small \textit{Visit safetyfirst.help | Email: salatiso@safetyfirst.help}}
\fancyfoot[R]{\small Page \thepage\ of \pageref{LastPage}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}
\fancyfoot[C]{\parbox[b]{\textwidth}{\footnotesize \textit{This document is generated by SafetyHelp for OHS compliance. Verify applicability with local regulations.}}}

\begin{document}

% Cover Page
\begin{titlepage}
  \centering
  \ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light}}{
    \includegraphics[height=1.5cm,keepaspectratio]{\safetyHelpLogo}\hfill
  }{}
  \vspace{2cm}
  \ifthen\isempty{\userLogo}{\textbf{\Large \userCompany}\vspace{1cm}}{\includegraphics[height=1.5cm]{\userLogo}\vspace{1cm}}
  {\Huge \textbf{\docTitle}}\vspace{1cm}
  {\Large Reference: \refNumber}\vspace{0.5cm}
  {\large Issue Date: \issueDate}\vspace{0.5cm}
  {\large Project: \projectName}\vspace{0.5cm}
  {\large Site: \siteAddress}\vspace{0.5cm}
  {\large Duration: \projectDuration}\vspace{0.5cm}
  {\large Client: \clientName, \clientAddress}\vspace{0.5cm}
  {\large Compiled By: \compilerName, \compilerRole}\vspace{0.5cm}
  {\large \compilerEmail, \compilerPhone}
  \vspace{2cm}
  \rule{\textwidth}{0.5pt}
\end{titlepage}

% Table of Contents
\tableofcontents
\newpage

% Introduction
\section{Introduction}
\subsection{Purpose}
This Notification of Construction Work complies with Construction Regulation 3 of the Occupational Health and Safety Act 85 of 1993, notifying the Department of Employment and Labour of construction activities for the \projectName\ project.

\subsection{Scope}
This notification applies to the \projectName\ project at \siteAddress, with an estimated duration of \projectDuration.

% Compiled By Details
\section{Compiled By Details}
\begin{tabularx}{\textwidth}{lX}
  \toprule
  \textbf{Field} & \textbf{Details} \\
  \midrule
  Name & \compilerName \\
  Role & \compilerRole \\
  SACPCMP Number & \compilerSACPCMP \\
  Email & \compilerEmail \\
  Phone & \compilerPhone \\
  Date & \issueDate \\
  \bottomrule
\end{tabularx}

% Revision History
\section{Revision History}
\begin{tabularx}{\textwidth}{lXll}
  \toprule
  \textbf{Rev} & \textbf{Date} & \textbf{Changes} & \textbf{Revised By} \\
  \midrule
  \revision & \issueDate & Initial version & \compilerName \\
  \bottomrule
\end{tabularx}

% Notification Details
\section{Notification Details}
\begin{itemize}
    \item \textbf{Project Name}: \projectName
    \item \textbf{Site Address}: \siteAddress
    \item \textbf{Duration}: \projectDuration
    \item \textbf{Client}: \clientName, \clientAddress, \clientContact
    \item \textbf{Principal Contractor}: \contractorName, \contractorAddress, \contractorContact
    \item \textbf{Notification Date}: \notificationDate
    \item \textbf{Submission}: To be submitted to the Provincial Director, Department of Employment and Labour.
\end{itemize}

% Signature Page
\section{Signature Page}
\begin{itemize}
  \item \textbf{Compiler}: \compilerName \\
    Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
  \item \textbf{Client Representative}: \\
    Name: \rule{5cm}{0.4pt} \quad Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
\end{itemize}

% Back Page
\ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light} \OR \equal{\brandingLevel}{none}}{
  \newpage
  \section*{About SafetyHelp}
  SafetyHelp is South Africa’s leading OHS platform, offering AI-powered tools for compliance, risk management, and safety education across industries like construction, mining, education, and healthcare.

  \textbf{Contact}: Visit \href{https://safetyfirst.help}{safetyfirst.help} or email \href{mailto:salatiso@safetyfirst.help}{salatiso@safetyfirst.help} to learn more.
  \vspace{2cm}
  \hfill \includegraphics[height=2cm]{\safetyHelpLogo}
}{}

\label{LastPage}
\end{document}
