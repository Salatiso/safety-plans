\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper, margin=2.5cm]{geometry}
\usepackage{fancyhdr}
\usepackage{draftwatermark}
\usepackage{tocbibind}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{noto}
\usepackage{ifthen}

% Branding variables
\newcommand{\brandingLevel}{light}
\newcommand{\userLogo}{}
\newcommand{\userCompany}{}
\newcommand{\safetyHelpLogo}{/safety-plans/assets/images/logo.png}
\SetWatermarkText{SafetyHelp}
\SetWatermarkScale{2}
\SetWatermarkColor[gray]{0.9}

% Dynamic fields
\newcommand{\docTitle}{Audit Report}
\newcommand{\refNumber}{}
\newcommand{\issueDate}{}
\newcommand{\auditPeriod}{}
\newcommand{\auditLocation}{}
\newcommand{\compilerName}{}
\newcommand{\compilerRole}{}
\newcommand{\compilerSACPCMP}{}
\newcommand{\compilerEmail}{}
\newcommand{\compilerPhone}{}
\newcommand{\compilerCompany}{}

% Header and Footer
\pagestyle{fancy}
\fancyhf{}
\ifthenelse{\equal{\brandingLevel}{heavy}}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}} \quad \includegraphics[height=1cm]{\safetyHelpLogo}}
  \fancyhead[R]{\small \compilerName}
  \SetWatermarkLightness{0.7}
}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}}}
  \fancyhead[R]{\small \compilerName}
}
\ifthenelse{\equal{\brandingLevel}{none}}{
  \SetWatermarkText{}
}{}
\fancyfoot[L]{\small \textit{Powered by SafetyHelp | Safety Personalized, Compliance Simplified}}
\fancyfoot[C]{\small \textit{Visit safetyfirst.help | Email: salatiso@safetyfirst.help}}
\fancyfoot[R]{\small Page \thepage\ of \pageref{LastPage}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}
\fancyfoot[C]{\parbox[b]{\textwidth}{\footnotesize \textit{This document is generated by SafetyHelp for OHS compliance. Verify applicability with local regulations.}}}

\begin{document}

% Cover Page
\begin{titlepage}
  \centering
  \ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light}}{
    \includegraphics[height=1.5cm,keepaspectratio]{\safetyHelpLogo}\hfill
  }{}
  \vspace{2cm}
  \ifthen\isempty{\userLogo}{\textbf{\Large \userCompany}\vspace{1cm}}{\includegraphics[height=1.5cm]{\userLogo}\vspace{1cm}}
  {\Huge \textbf{\docTitle}}\vspace{1cm}
  {\Large Reference: \refNumber}\vspace{0.5cm}
  {\large Issue Date: \issueDate}\vspace{0.5cm}
  {\large Audit Period: \auditPeriod}\vspace{0.5cm}
  {\large Location: \auditLocation}\vspace{0.5cm}
  {\large Compiled By: \compilerName, \compilerRole}\vspace{0.5cm}
  {\large \compilerEmail, \compilerPhone}
  \vspace{2cm}
  \rule{\textwidth}{0.5pt}
\end{titlepage}

% Table of Contents
\tableofcontents
\newpage

% Introduction
\section{Introduction}
This \docTitle\ details audit findings for the period \auditPeriod\ at \auditLocation, ensuring compliance with OHSA Section 13.

% Compiled By Details
\section{Compiled By Details}
\begin{tabularx}{\textwidth}{lX}
  \toprule
  \textbf{Field} & \textbf{Details} \\
  \midrule
  Name & \compilerName \\
  Role & \compilerRole \\
  SACPCMP Number & \compilerSACPCMP \\
  Email & \compilerEmail \\
  Phone & \compilerPhone \\
  Date & \issueDate \\
  Company & \compilerCompany \\
  \bottomrule
\end{tabularx}

% Revision History
\section{Revision History}
\begin{tabularx}{\textwidth}{lXll}
  \toprule
  \textbf{Rev} & \textbf{Date} & \textbf{Changes} & \textbf{Revised By} \\
  \midrule
  1.0 & \issueDate & Initial Release & \compilerName \\
  \bottomrule
\end{tabularx}

% Content-Specific Sections
\section{Audit Summary}
[Dynamically populated: company name, findings summary.]

\section{Compliance Checklist}
[Dynamically populated: areas audited, compliance status.]

\section{Recommendations}
[Dynamically populated: corrective actions.]

% Signature Page
\section{Signature Page}
\begin{itemize}
  \item \textbf{Compiler}: \compilerName \\
    Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
  \item \textbf{Compiled For}: [Client Name] \\
    Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
\end{itemize}

% Back Page
\ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light} \OR \equal{\brandingLevel}{none}}{
  \newpage
  \section*{About SafetyHelp}
  SafetyHelp is South Africaâ€™s leading OHS platform, offering AI-powered tools for compliance, risk management, and safety education across industries like construction, mining, education, and healthcare.

  \textbf{Comprehensive Services}: \\
  \textit{OHS Tools}: \\
  \begin{itemize}
    \item \textit{Construction Safety}: Generate H\&S specifications, plans, risk assessments, legal appointments (OHSA, COIDA compliance).
    \item \textit{Risk Management Plans}: Step-by-step wizard with ISO 45001 integration.
    \item \textit{Document Library}: Policies, procedures, templates, permits, records (downloadable PDFs).
  \end{itemize}
  \textit{Training and Education}: \\
  \begin{itemize}
    \item \textit{Training Wizard}: Tailored programs by industry, audience, location (PDF guides, online videos Q3 2025).
    \item \textit{Training Provider Directory}: Connect with accredited providers.
  \end{itemize}
  \textit{Community Safety Tools}: \\
  \begin{itemize}
    \item \textit{Incident Reporting}: Report hazards (e.g., potholes, equipment issues) with photos, location, weather data, share via email/SMS/WhatsApp/X.
    \item \textit{Safety Checklists}: For spaza shops, schools, hospitals, taverns.
  \end{itemize}
  \textit{Multilingual Accessibility}: Supports 15 languages (English, Zulu, Xhosa, Afrikaans, Mandarin, etc.) for inclusivity. \\
  \textit{User Dashboard}: Profile management, saved resources (RMPs, incident reports), supplier directory with reviews. \\
  \textit{Upcoming Features}: \\
  \begin{itemize}
    \item Online Video Training (Q3 2025)
    \item Mobile App (iOS/Android, Q4 2025)
    \item AI Chatbot Enhancements (Q2 2026)
  \end{itemize}

  \textbf{Contact}: Visit \href{https://safetyfirst.help}{safetyfirst.help} or email \href{mailto:salatiso@safetyfirst.help}{salatiso@safetyfirst.help} to learn more. Become a member to customize documents and remove branding!

  \vspace{2cm}
  \hfill \includegraphics[height=2cm]{\safetyHelpLogo}
}{}

\label{LastPage}
\end{document}
