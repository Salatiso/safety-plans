\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper, margin=2.5cm]{geometry}
\usepackage{fancyhdr}
\usepackage{draftwatermark}
\usepackage{tocbibind}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{noto}
\usepackage{ifthen}

% Branding variables
\newcommand{\brandingLevel}{light}
\newcommand{\userLogo}{}
\newcommand{\userCompany}{{{COMPANY_NAME}}}
\newcommand{\safetyHelpLogo}{/safety-plans/assets/images/logo.png}
\SetWatermarkText{SafetyHelp}
\SetWatermarkScale{2}
\SetWatermarkColor[gray]{0.9}

% Dynamic fields
\newcommand{\docTitle}{Health and Safety Plan}
\newcommand{\refNumber}{HSP-001}
\newcommand{\issueDate}{{{DATE}}}
\newcommand{\projectName}{{{PROJECT_NAME}}}
\newcommand{\siteAddress}{{{SITE_ADDRESS}}}
\newcommand{\projectDuration}{{{PROJECT_DURATION}}}
\newcommand{\projectCost}{{{PROJECT_COST}}}
\newcommand{\clientName}{{{COMPANY_NAME}}}
\newcommand{\clientAddress}{{{COMPANY_ADDRESS}}}
\newcommand{\clientContact}{{{COMPANY_CONTACT}}, {{COMPANY_EMAIL}}}
\newcommand{\contractorName}{{{CONTRACTOR_NAME}}}
\newcommand{\contractorAddress}{{{CONTRACTOR_ADDRESS}}}
\newcommand{\contractorContact}{{{CONTRACTOR_CONTACT}}, {{CONTRACTOR_EMAIL}}}
\newcommand{\compilerName}{{{COMPILED_BY_NAME}}}
\newcommand{\compilerRole}{{{COMPILED_BY_ROLE}}}
\newcommand{\compilerSACPCMP}{{{SACPCMP_NUMBER}}}
\newcommand{\compilerEmail}{{{COMPILED_BY_EMAIL}}}
\newcommand{\compilerPhone}{{{COMPILED_BY_CONTACT}}}
\newcommand{\revision}{{{REVISION}}}
\newcommand{\reviewDate}{{{REVIEW_DATE}}}
\newcommand{\INCLUDE_BRA}{{{INCLUDE_BRA}}}
\newcommand{\INCLUDE_S37}{{{INCLUDE_S37}}}
\newcommand{\INCLUDE_NCW}{{{INCLUDE_NCW}}}

% Header and Footer
\pagestyle{fancy}
\fancyhf{}
\ifthenelse{\equal{\brandingLevel}{heavy}}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}} \quad \includegraphics[height=1cm]{\safetyHelpLogo}}
  \fancyhead[R]{\small \compilerName}
  \SetWatermarkLightness{0.7}
}{
  \fancyhead[L]{\small \refNumber}
  \fancyhead[C]{\ifthen\isempty{\userLogo}{\textbf{\userCompany}}{\includegraphics[height=1.5cm]{\userLogo}}}
  \fancyhead[R]{\small \compilerName}
}
\ifthenelse{\equal{\brandingLevel}{none}}{
  \SetWatermarkText{}
}{}
\fancyfoot[L]{\small \textit{Powered by SafetyHelp | Safety Personalized, Compliance Simplified}}
\fancyfoot[C]{\small \textit{Visit safetyfirst.help | Email: salatiso@safetyfirst.help}}
\fancyfoot[R]{\small Page \thepage\ of \pageref{LastPage}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}
\fancyfoot[C]{\parbox[b]{\textwidth}{\footnotesize \textit{This document is generated by SafetyHelp for OHS compliance. Verify applicability with local regulations.}}}

\begin{document}

% Cover Page
\begin{titlepage}
  \centering
  \ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light}}{
    \includegraphics[height=1.5cm,keepaspectratio]{\safetyHelpLogo}\hfill
  }{}
  \vspace{2cm}
  \ifthen\isempty{\userLogo}{\textbf{\Large \userCompany}\vspace{1cm}}{\includegraphics[height=1.5cm]{\userLogo}\vspace{1cm}}
  {\Huge \textbf{\docTitle}}\vspace{1cm}
  {\Large Reference: \refNumber}\vspace{0.5cm}
  {\large Issue Date: \issueDate}\vspace{0.5cm}
  {\large Review Date: \reviewDate}\vspace{0.5cm}
  {\large Project: \projectName}\vspace{0.5cm}
  {\large Client: \clientName, \clientAddress}\vspace{0.5cm}
  {\large Compiled By: \compilerName, \compilerRole}\vspace{0.5cm}
  {\large \compilerEmail, \compilerPhone}
  \vspace{2cm}
  \rule{\textwidth}{0.5pt}
\end{titlepage}

% Table of Contents
\tableofcontents
\newpage

% Introduction
\section{Introduction}
\subsection{Purpose}
This Health and Safety Plan, developed by \contractorName, addresses the occupational health and safety requirements outlined in the Health and Safety Specification for the \projectName\ project, ensuring compliance with the Occupational Health and Safety Act 85 of 1993 and Construction Regulations, 2014.

\subsection{Scope}
This plan applies to all construction activities undertaken by \contractorName\ at \siteAddress\ for the \projectName\ project.

% Project Description
\section{Project Description}
\begin{itemize}
    \item \textbf{Project Name}: \projectName
    \item \textbf{Site Address}: \siteAddress
    \item \textbf{Duration}: \projectDuration
    \item \textbf{Cost}: \projectCost
    \item \textbf{Client}: \clientName, \clientAddress, \clientContact
    \item \textbf{Principal Contractor}: \contractorName, \contractorAddress, \contractorContact
\end{itemize}

% Compiled By Details
\section{Compiled By Details}
\begin{tabularx}{\textwidth}{lX}
  \toprule
  \textbf{Field} & \textbf{Details} \\
  \midrule
  Name & \compilerName \\
  Role & \compilerRole \\
  SACPCMP Number & \compilerSACPCMP \\
  Email & \compilerEmail \\
  Phone & \compilerPhone \\
  Date & \issueDate \\
  \bottomrule
\end{tabularx}

% Revision History
\section{Revision History}
\begin{tabularx}{\textwidth}{lXll}
  \toprule
  \textbf{Rev} & \textbf{Date} & \textbf{Changes} & \textbf{Revised By} \\
  \midrule
  \revision & \issueDate & Initial version & \compilerName \\
  \bottomrule
\end{tabularx}

% Health and Safety Management
\section{Health and Safety Management}
\subsection{Risk Management}
Based on the Baseline Risk Assessment, task-specific risk assessments will be conducted per Construction Regulation 9.
\subsection{Training}
All workers will receive induction and task-specific training, with records maintained in the Health and Safety File.
\subsection{Emergency Procedures}
Emergency response plans will be established per Construction Regulation 29.

% Legal Appointments
\section{Legal Appointments}
\begin{itemize}
    \item Construction Manager: Appointed per Construction Regulation 8(1).
    \item Health and Safety Officer: Appointed per Regulation 8(5).
\end{itemize}

% Contractor Management
\section{Contractor Management}
Subcontractors will comply with this plan and provide their own risk assessments and training records.

% Annexures
\section{Annexures}
\begin{itemize}
    \item \textbf{Annexure A: Risk Assessment Plan Template} (See Forms/Checklists)
    \item \textbf{Annexure B: Baseline Risk Assessment} \ifthenelse{\equal{\INCLUDE_BRA}{yes}}{(Generated for \projectName)}{(Not included)}
    \item \textbf{Annexure C: Section 37(2) Agreement} \ifthenelse{\equal{\INCLUDE_S37}{yes}}{(Generated for \projectName)}{(Not included)}
    \item \textbf{Annexure D: Notification of Construction Work} \ifthenelse{\equal{\INCLUDE_NCW}{yes}}{(Generated for \projectName)}{(Not included)}
    \item \textbf{Annexure E: Training Records} (See Training Logs)
\end{itemize}

% Signature Page
\section{Signature Page}
\begin{itemize}
  \item \textbf{Compiler}: \compilerName \\
    Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
  \item \textbf{Approved By}: {{CEO_NAME}} \\
    Signature: \rule{5cm}{0.4pt} \quad Date: \rule{3cm}{0.4pt}
\end{itemize}

% Back Page
\ifthenelse{\equal{\brandingLevel}{heavy} \OR \equal{\brandingLevel}{light} \OR \equal{\brandingLevel}{none}}{
  \newpage
  \section*{About SafetyHelp}
  SafetyHelp is South Africaâ€™s leading OHS platform, offering AI-powered tools for compliance, risk management, and safety education across industries like construction, mining, education, and healthcare.

  \textbf{Comprehensive Services}: \\
  \textit{OHS Tools}: \\
  \begin{itemize}
    \item \textit{Construction Safety}: Generate H\&S specifications, plans, risk assessments, legal appointments (OHSA, COIDA compliance).
    \item \textit{Risk Management Plans}: Step-by-step wizard with ISO 45001 integration.
    \item \textit{Document Library}: Policies, procedures, templates, permits, records (downloadable PDFs).
  \end{itemize}
  \textit{Training and Education}: \\
  \begin{itemize}
    \item \textit{Training Wizard}: Tailored programs by industry, audience, location (PDF guides, online videos Q3 2025).
    \item \textit{Training Provider Directory}: Connect with accredited providers.
  \end{itemize}
  \textit{Community Safety Tools}: \\
  \begin{itemize}
    \item \textit{Incident Reporting}: Report hazards (e.g., potholes, equipment issues) with photos, location, weather data, share via email/SMS/WhatsApp/X.
    \item \textit{Safety Checklists}: For spaza shops, schools, hospitals, taverns.
  \end{itemize}
  \textit{Multilingual Accessibility}: Supports 15 languages (English, Zulu, Xhosa, Afrikaans, Mandarin, etc.) for inclusivity. \\
  \textit{User Dashboard}: Profile management, saved resources (RMPs, incident reports), supplier directory with reviews. \\
  \textit{Upcoming Features}: \\
  \begin{itemize}
    \item Online Video Training (Q3 2025)
    \item Mobile App (iOS/Android, Q4 2025)
    \item AI Chatbot Enhancements (Q2 2026)
  \end{itemize}

  \textbf{Contact}: Visit \href{https://safetyfirst.help}{safetyfirst.help} or email \href{mailto:salatiso@safetyfirst.help}{salatiso@safetyfirst.help} to learn more. Become a member to customize documents and remove branding!

  \vspace{2cm}
  \hfill \includegraphics[height=2cm]{\safetyHelpLogo}
}{}

\label{LastPage}
\end{document}
