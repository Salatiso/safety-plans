<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="SafetyHelp OHS Tools - Your go-to resource for Occupational Health and Safety tools. Safety Personalized, Compliance Simplified—Anytime, Anywhere.">
  <meta name="keywords" content="OHS tools, occupational health and safety, safety plans, South Africa OHS">
  <meta name="author" content="SafetyHelp Team">
  <title>SafetyHelp - Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/i18next@23.15.2/dist/umd/i18next.min.js"></script>
  <style>
    /* Global Styles */
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #E8F0FE;
      color: #333;
      margin: 0;
      padding-top: 100px;
      display: flex;
    }
    header h1, .sidebar h2, .sidebar h3, .intro h2, footer h3 {
      font-family: 'Montserrat', sans-serif;
    }
    /* Header */
    header {
      background-color: #007BFF;
      color: white;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      width: 100%;
    }
    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
    }
    .logo-container {
      padding-left: 10px;
      text-align: left;
    }
    .logo-container img {
      height: 50px;
    }
    .tagline {
      font-size: 14px;
      margin-top: 5px;
    }
    .header-right {
      display: flex;
      align-items: center;
    }
    .nav-links a {
      color: white;
      margin: 0 10px;
      font-family: 'Montserrat', sans-serif;
      text-decoration: none;
    }
    .nav-links a:hover {
      color: #FD7E14;
    }
    .search-language-container {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      margin-left: 20px;
    }
    .search-bar button {
      background-color: #FD7E14;
      color: white;
    }
    .search-bar button:hover {
      background-color: #e06b00;
    }
    .language-selector {
      margin-bottom: 5px;
    }
    .language-selector select {
      padding: 4px;
      border-radius: 4px;
      font-size: 14px;
    }
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 100px;
      left: 0;
      bottom: 0;
      width: 250px;
      background-color: #F4F4F4;
      overflow-y: auto;
      z-index: 40;
      padding: 15px;
    }
    .sidebar h2 {
      color: #007BFF;
      font-size: 24px;
      margin-bottom: 15px;
    }
    .sidebar a {
      color: white;
      background-color: #007BFF;
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 5px;
      display: block;
      text-decoration: none;
      font-size: 14px;
      transition: font-weight 0.3s;
    }
    .sidebar a:hover {
      font-weight: bold;
      background-color: #0056b3;
    }
    .sidebar a.active {
      background-color: #28A745;
    }
    .step-info {
      background-color: #E8F0FE;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }
    .step-info h3 {
      font-family: 'Montserrat', sans-serif;
      font-size: 18px;
      color: #007BFF;
      margin-bottom: 10px;
    }
    .step-info p {
      font-size: 14px;
    }
    .fun-fact {
      color: #28A745;
    }
    /* Main Content */
    .main-content {
      margin-left: 250px;
      flex-grow: 1;
      padding: 1.5rem;
      min-height: calc(100vh - 100px);
      display: flex;
      flex-direction: row;
      gap: 20px;
    }
    .intro {
      flex: 1;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    .intro h2 {
      font-size: 24px;
      color: #333;
      margin-bottom: 10px;
    }
    .intro h3 {
      font-size: 20px;
      color: #333;
      margin-bottom: 10px;
    }
    .intro p {
      font-size: 14px;
      color: #666;
      margin-bottom: 15px;
    }
    .intro a {
      background-color: #FD7E14;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      text-decoration: none;
    }
    .intro a:hover {
      background-color: #e06b00;
    }
    /* Carousel */
    .carousel-container {
      flex: 1;
      max-width: 300px;
      position: relative;
    }
    .carousel-item {
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: transform 0.3s ease;
      margin-bottom: 10px;
    }
    .carousel-item:hover {
      transform: scale(1.05);
      font-weight: bold;
    }
    .carousel-item h4 {
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      color: #007BFF;
      margin-bottom: 5px;
    }
    .carousel-item p {
      font-size: 14px;
      color: #333;
    }
    .carousel-item.active {
      display: block;
    }
    .carousel-item:not(.active) {
      display: none;
    }
    .carousel-prev, .carousel-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: #FD7E14;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    .carousel-prev:hover, .carousel-next:hover {
      background-color: #e06b00;
    }
    .carousel-prev {
      left: -50px;
    }
    .carousel-next {
      right: -50px;
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
      position: relative;
    }
    .modal-content h4 {
      font-family: 'Montserrat', sans-serif;
      font-size: 18px;
      color: #007BFF;
      margin-bottom: 10px;
    }
    .modal-content p {
      font-size: 14px;
      color: #333;
      margin-bottom: 10px;
    }
    .modal-content a {
      color: #28A745;
      text-decoration: underline;
    }
    .modal-content a:hover {
      color: #1e7e34;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      cursor: pointer;
      color: #333;
    }
    /* Footer */
    footer {
      background-color: #007BFF;
      color: white;
      padding: 15px;
      text-align: center;
      width: 100%;
    }
    footer p {
      font-size: 14px;
      margin: 5px 0;
    }
    footer a {
      color: #FD7E14;
      text-decoration: none;
    }
    footer a:hover {
      color: #e06b00;
    }
    /* Newsletter (if used) */
    .newsletter h3 {
      font-size: 14px;
      margin-bottom: 8px;
    }
    .newsletter input {
      padding: 8px;
      border: none;
      border-radius: 2px;
      margin-right: 10px;
      font-size: 14px;
      width: 150px;
    }
    .newsletter button {
      padding: 8px 16px;
      background-color: #FD7E14;
      color: white;
      border: none;
      border-radius: 2px;
      cursor: pointer;
      font-size: 14px;
    }
    .newsletter button:hover {
      background-color: #e06b00;
    }
    /* Chatbot */
    .chatbot-container {
      position: fixed;
      bottom: 1.25rem;
      right: 1.25rem;
      z-index: 1000;
    }
    #chat-window {
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .chat-hidden {
      display: none;
    }
    #chat-output {
      flex-grow: 1;
    }
    #chat-input-container {
      display: flex;
      border-top-width: 1px;
    }
    #chat-input {
      flex-grow: 1;
      border: none;
      padding: 0.5rem;
    }
    #chat-send {
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      background-color: #007BFF;
      color: white;
    }
    #chat-send:hover {
      background-color: #0056b3;
    }
    .chat-toggle-btn {
      background-color: #FD7E14;
    }
    .chat-toggle-btn:hover {
      background-color: #e06b00;
    }
    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        padding-top: 0;
        flex-direction: column;
      }
      header {
        position: relative;
      }
      .header-container {
        flex-direction: column;
        align-items: flex-start;
      }
      .logo-container {
        width: 100%;
        text-align: center;
        padding-left: 0;
      }
      .header-right {
        width: 100%;
        flex-direction: column;
        align-items: center;
      }
      .search-language-container {
        align-items: center;
        margin-left: 0;
        margin-top: 10px;
      }
      .sidebar {
        position: relative;
        top: 0;
        width: 100%;
        height: auto;
        bottom: auto;
        z-index: 1;
      }
      .main-content {
        margin-left: 0;
        flex-direction: column;
      }
      .intro {
        margin: 1rem 0;
      }
      .carousel-container {
        max-width: 100%;
        margin: 1rem 0;
      }
    }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Header -->
  <header class="bg-gray-900 text-white shadow-md">
    <div class="container mx-auto header-container">
      <div class="logo-container">
        <img src="../images/logo.png" alt="SafetyHelp Logo">
        <p class="tagline">Safety Personalized, Compliance Simplified—Anytime, Anywhere</p>
      </div>
      <div class="header-right">
        <div class="nav-links mb-4 md:mb-0">
          <a href="/safety-plans/index.html">Home</a>
          <a href="/safety-plans/resources.html">Resources</a>
          <a href="/safety-plans/services.html">Services</a>
          <a href="/safety-plans/community.html">Community</a>
          <a href="/safety-plans/about.html">About</a>
          <a href="/safety-plans/contact.html">Contact</a>
        </div>
        <div class="search-language-container">
          <div class="language-selector">
            <select id="language-select" aria-label="Select language">
              <option value="en">English</option>
              <option value="af">Afrikaans</option>
              <option value="zu">isiZulu</option>
              <option value="xh">isiXhosa</option>
              <option value="st">Sesotho</option>
              <option value="tn">Setswana</option>
              <option value="nso">Sepedi</option>
              <option value="ts">Xitsonga</option>
              <option value="ss">siSwati</option>
              <option value="ve">Tshivenda</option>
              <option value="nr">isiNdebele</option>
              <option value="es">Español</option>
              <option value="fr">French</option>
              <option value="sn">Shona</option>
              <option value="sw">Swahili</option>
              <option value="zh">Mandarin</option>
            </select>
          </div>
          <div class="search-bar">
            <form role="search" class="flex">
              <input type="text" placeholder="Search OHS Tools..." aria-label="Search OHS Tools" class="px-3 py-1 border border-gray-300 rounded-l text-gray-800">
              <button type="submit" aria-label="Search" class="px-4 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-r">Search</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar">
    <h2 data-i18n="sidebar.ohs_tools">SafetyHelp OHS Tools</h2>
    <ul class="space-y-2">
      <li><a href="/safety-plans/pages/construction-compliance.html" data-i18n="sidebar.construction_safety">Construction Safety</a></li>
      <li><a href="/safety-plans/pages/emergency-response-plan.html" data-i18n="sidebar.emergency_planning">Emergency Planning</a></li>
      <li><a href="/safety-plans/pages/risk-assessment.html" data-i18n="sidebar.risk_assessment">Risk Assessment</a></li>
      <li><a href="/safety-plans/pages/legal-appointments.html" data-i18n="sidebar.legal_appointments">Legal Appointments</a></li>
      <li><a href="/safety-plans/pages/incident-management.html" data-i18n="sidebar.incident_management">Incident Management</a></li>
      <li><a href="/safety-plans/pages/training.html" data-i18n="sidebar.training">Training</a></li>
      <li><a href="/safety-plans/pages/inspections-audits.html" data-i18n="sidebar.inspections_audits">Inspections & Audits</a></li>
      <li><a href="/safety-plans/pages/suppliers.html" data-i18n="sidebar.suppliers">Suppliers</a></li>
      <li><a href="/safety-plans/pages/legislation.html" data-i18n="sidebar.legislation">Legislation</a></li>
      <li><a href="/safety-plans/pages/community-tools.html" data-i18n="sidebar.community_tools">Community Tools</a></li>
      <li><a href="/safety-plans/pages/member-dashboard.html" data-i18n="sidebar.member_dashboard">Member Dashboard</a></li>
      <li><a href="/safety-plans/pages/ohs-system.html" data-i18n="sidebar.ohs_system" class="active">OHS System</a></li>
    </ul>
    <div class="step-info">
      <h3 data-i18n="sidebar.step_0.title">📜 Welcome to SafetyHelp OHS Tools</h3>
      <p data-i18n="sidebar.step_0.description" class="text-sm mb-3">Explore our comprehensive tools and resources to enhance occupational health and safety in your workplace.</p>
      <p class="fun-fact text-sm" data-i18n="sidebar.step_0.fun_fact">⚡ Did you know ethical safety practices have evolved over millennia to create safer workplaces?</p>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Intro Section -->
    <section class="intro">
      <h2 class="text-2xl font-bold mb-4">Welcome to SafetyHelp OHS Tools</h2>
      <p class="text-gray-600">Explore our comprehensive tools and resources to enhance occupational health and safety in your workplace.</p>
      <div class="mt-6">
        <h3 class="text-xl font-semibold mb-2">Featured Tool: Construction Compliance</h3>
        <p class="text-gray-600 mb-4">Ensure your construction projects meet all necessary health and safety regulations with our detailed compliance checklist and plan generator.</p>
        <a href="/safety-plans/pages/construction-compliance.html" class="inline-block">Learn More</a>
      </div>
    </section>
    <!-- Carousel Section -->
    <div class="carousel-container" id="carousel-container">
      <!-- Carousel items are rendered dynamically -->
      <button class="carousel-prev">Prev</button>
      <button class="carousel-next">Next</button>
    </div>
  </div>

  <!-- Modal for Carousel Detailed Info -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span id="modal-close-btn" class="close-btn">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- Chatbot Container -->
  <div class="chatbot-container">
    <button id="chat-toggle" class="chat-toggle-btn px-3 py-1">Chat</button>
    <div id="chat-window" class="chat-hidden bg-white p-4 shadow-lg rounded">
      <div id="chat-output"></div>
      <div id="chat-input-container" class="mt-2">
        <input type="text" id="chat-input" placeholder="Ask a question...">
        <button id="chat-send">Send</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>© 2025 SafetyHelp OHS Tools. All rights reserved.</p>
  </footer>

  <!-- Scripts: Carousel, Modal, Firebase, and Chatbot -->
  <script>
    // Carousel Data: Items from Prehistoric to 2025
    const carouselData = [
      {
        title: "🦕 Prehistoric Safety",
        details: "In prehistoric times, early humans relied on instinct, communal learning, and rudimentary tools to navigate everyday hazards in nature.",
        link: "https://example.com/prehistoric-safety"
      },
      {
        title: "🏺 Ancient Civilizations",
        details: "Ancient civilizations introduced formalized safety practices. For example, Roman builders adopted innovative structural techniques that protected workers.",
        link: "https://example.com/ancient-safety"
      },
      {
        title: "⚙️ Industrial Revolution",
        details: "The Industrial Revolution brought about the first safety regulations in factories, as innovators and lawmakers began formalizing occupational health standards.",
        link: "https://example.com/industrial-safety"
      },
      {
        title: "🚧 Modern Safety",
        details: "The 20th century saw the establishment of comprehensive systems and regulations designed to safeguard workers across all industries.",
        link: "https://example.com/modern-safety"
      },
      {
        title: "🌐 Safety in 2025",
        details: "In 2025, digital innovations, data analytics, and AI revolutionize OHS, enabling real-time hazard monitoring and proactive compliance measures.",
        link: "https://example.com/digital-safety"
      }
    ];

    let currentCarouselIndex = 0;

    function renderCarousel() {
      const carouselContainer = document.getElementById('carousel-container');
      // Remove any existing carousel items (retain Prev/Next buttons)
      carouselContainer.querySelectorAll('.carousel-item').forEach(item => item.remove());
      
      // Render carousel items; only the active item is shown
      carouselData.forEach((item, index) => {
        const carouselItem = document.createElement('div');
        carouselItem.className = 'carousel-item' + (index === currentCarouselIndex ? ' active' : '');
        carouselItem.setAttribute('data-index', index);
        carouselItem.innerHTML = `<h4>${item.title}</h4><p>${item.details.substring(0, 50)}...</p>`;
        carouselContainer.appendChild(carouselItem);
      });
    }

    function setCarouselEventListeners() {
      const carouselItems = document.querySelectorAll('.carousel-item');
      carouselItems.forEach(item => {
        item.addEventListener('click', () => {
          const index = item.getAttribute('data-index');
          const content = carouselData[index];
          modalBody.innerHTML = `
            <h4>${content.title}</h4>
            <p>${content.details}</p>
            <p><a href="${content.link}" target="_blank" class="text-blue-500 hover:underline">Learn More</a></p>
          `;
          modal.style.display = 'flex';
        });
      });
    }

    document.querySelector('.carousel-prev').addEventListener('click', () => {
      currentCarouselIndex = (currentCarouselIndex - 1 + carouselData.length) % carouselData.length;
      renderCarousel();
      setCarouselEventListeners();
    });

    document.querySelector('.carousel-next').addEventListener('click', () => {
      currentCarouselIndex = (currentCarouselIndex + 1) % carouselData.length;
      renderCarousel();
      setCarouselEventListeners();
    });

    renderCarousel();
    setCarouselEventListeners();

    // Modal functionality
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');
    const closeBtn = document.getElementById('modal-close-btn');

    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if(e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Firebase and Chatbot (unchanged)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID",
      measurementId: "YOUR_MEASUREMENT_ID"
    };

    let db;

    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      console.log("Firebase Initialized Successfully");
    } catch (error) {
      console.error("Firebase initialization failed:", error);
      const chatOutput = document.getElementById('chat-output');
      if (chatOutput) {
        chatOutput.innerHTML += "<p class='text-red-600'><strong>Error:</strong> Chatbot unavailable due to configuration issue.</p>";
      }
      const chatInput = document.getElementById('chat-input');
      const chatSend = document.getElementById('chat-send');
      if (chatInput) chatInput.disabled = true;
      if (chatSend) chatSend.disabled = true;
    }

    const chatToggle = document.getElementById('chat-toggle');
    const chatWindow = document.getElementById('chat-window');
    const chatOutput = document.getElementById('chat-output');
    const chatInput = document.getElementById('chat-input');
    const chatSend = document.getElementById('chat-send');

    if (chatToggle) {
      chatToggle.addEventListener('click', () => {
        chatWindow.classList.toggle('chat-hidden');
        if (!chatWindow.classList.contains('chat-hidden')) {
          chatInput.focus();
        }
      });
    }

    function addChatMessage(sender, message) {
      if (chatOutput) {
        const messageElement = document.createElement('p');
        messageElement.classList.add('mb-2');
        messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
        chatOutput.appendChild(messageElement);
        chatOutput.scrollTop = chatOutput.scrollHeight;
      }
    }

    async function sendQuery() {
      if (!db) {
        addChatMessage('Chatbot', 'Sorry, the chatbot is currently unavailable.');
        return;
      }

      const input = chatInput.value.trim();
      if (!input) return;

      addChatMessage('You', input);
      chatInput.value = '';
      addChatMessage('Chatbot', 'Searching...');

      const query = input.toLowerCase();

      try {
        const snapshot = await db.collection('ohs-knowledge')
          .where('keywords', 'array-contains', query)
          .limit(1)
          .get();

        let responseFound = false;
        let response = "Sorry, I couldn’t find specific information on that topic. Please try rephrasing or ask a different question.";

        if (!snapshot.empty) {
          snapshot.forEach(doc => {
            const data = doc.data();
            response = `Based on information from ${data.book || 'our resources'} (Chapter ${data.chapter || 'N/A'}), here's a summary: <br>${data.content.substring(0, 250)}...`;
            if (data.file) {
              response += ` (See <a href="/safety-plans/resources/${data.file}" target="_blank" class="text-blue-500 hover:underline">full chapter</a>)`;
            }
            responseFound = true;
          });
        }

        const searchingMessage = chatOutput.querySelector('p:last-child');
        if(searchingMessage && searchingMessage.textContent.includes('Searching...')) {
          searchingMessage.innerHTML = `<strong>Chatbot:</strong> ${response}`;
        } else {
          addChatMessage('Chatbot', response);
        }
      } catch (error) {
        console.error("Firestore query failed:", error);
        const searchingMessage = chatOutput.querySelector('p:last-child');
        if(searchingMessage && searchingMessage.textContent.includes('Searching...')) {
          searchingMessage.innerHTML = `<strong>Chatbot:</strong> Oops, something went wrong while searching. Please try again!`;
        } else {
          addChatMessage('Chatbot', 'Oops, something went wrong while searching. Please try again!');
        }
      }
    }

    if (chatSend) {
      chatSend.addEventListener('click', sendQuery);
    }
    if (chatInput) {
      chatInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          sendQuery();
        }
      });
    }
  </script>
</body>
</html>
